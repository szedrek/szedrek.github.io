<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Szedrek 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dZWTgaQzuU17R8"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700;900&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        html, body {
            height: 100%;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            overflow: hidden; /* keep the site always fullscreen */
        }
        body { font-family: 'Outfit', sans-serif; }
        .serif { font-family: 'Playfair Display', serif; }
        
        /* Cinematic Overlays */
        .cinematic-grain {
            position: fixed;
            inset: 0;
            z-index: 90;
            pointer-events: none;
            opacity: 0.06;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }
        .cinematic-vignette {
            position: fixed;
            inset: 0;
            z-index: 80;
            pointer-events: none;
            background: radial-gradient(circle at center, transparent 40%, rgba(0,0,0,0.8) 100%);
        }

        /* Smooth Slide Transitions - EPIC FEEL */
        /* Make slides cover the viewport fully so the site is always fullscreen */
        .slide {
            /* slightly snappier but still cinematic transitions */
            transition: transform 1.8s cubic-bezier(0.22, 1, 0.36, 1), opacity 1.4s ease, filter 1.4s ease;
            position: fixed; /* fixed so it always fills the viewport */
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            opacity: 0;
            pointer-events: none;
            transform: scale(1.2) translateY(50px);
            filter: blur(20px) brightness(0.3) grayscale(0.5);
            z-index: 0;
            overflow: hidden;
        }
        .slide.active {
            opacity: 1;
            pointer-events: all;
            transform: scale(1) translateY(0);
            filter: blur(0) brightness(1) grayscale(0);
            z-index: 10;
        }
        .slide.prev {
            transform: scale(1.1) translateY(-100%);
            opacity: 0;
            z-index: 5;
            filter: brightness(0.5);
        }

        /* Ken Burns Effect - Slower, more majestic */
        .ken-burns {
            animation: kenburns 40s infinite alternate cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes kenburns {
            0% { transform: scale(1) translate(0, 0); }
            100% { transform: scale(1.25) translate(-3%, -3%); }
        }

        /* Glassmorphism & 3D Tilt - More refined */
        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.8), inset 0 0 0 1px rgba(255,255,255,0.05);
            transform-style: preserve-3d;
            transition: transform 0.2s cubic-bezier(0.03, 0.98, 0.52, 0.99);
        }
        
        /* Basic Reveal Text (non-title elements) */
        .reveal-text {
            opacity: 0;
            visibility: hidden;
            transform: translateY(30px);
            filter: blur(10px);
            transition: all 1.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .reveal-text.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
            filter: blur(0);
        }
        
        /* Movie Typography */
        .movie-title {
            font-family: 'Playfair Display', serif;
            font-style: italic;
            text-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .movie-subtitle {
            font-family: 'Outfit', sans-serif;
            letter-spacing: 0.3em;
            text-transform: uppercase;
            text-shadow: 0 2px 10px rgba(0,0,0,0.8);
        }
        .chapter-number {
            font-family: 'Outfit', sans-serif;
            font-weight: 900;
            opacity: 0.5;
            mix-blend-mode: overlay;
        }

        /* Gradient Overlays for Text Readability */
        .gradient-overlay-bottom {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.4) 40%, transparent 100%);
            pointer-events: none;
        }

        /* Ensure images inside slides always cover the viewport */
        .slide img, .slide picture, .slide video {
            width: 100vw;
            height: 100vh;
            object-fit: cover;
            display: block;
        }
        .gradient-overlay-left {
            position: absolute;
            inset: 0;
            background: linear-gradient(to right, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.2) 50%, transparent 100%);
            pointer-events: none;
        }

        /* Dust Particles */
        .dust-mote {
            position: absolute;
            background: white;
            border-radius: 50%;
            pointer-events: none;
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }
        @keyframes floatDust {
            0% { transform: translateY(110vh) translateX(-20px) rotate(0deg); opacity: 0; }
            20% { opacity: 0.6; }
            80% { opacity: 0.6; }
            100% { transform: translateY(-10vh) translateX(20px) rotate(360deg); opacity: 0; }
        }

        /* Floating Animation */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        /* Particles */
        .particle {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.5;
            pointer-events: none;
        }
        @keyframes snowfall {
            0% { transform: translateY(-10vh) translateX(0); opacity: 0; }
            20% { opacity: 0.8; }
            100% { transform: translateY(110vh) translateX(20px); opacity: 0; }
        }
        .snow {
            animation: snowfall linear infinite;
        }

        /* Custom Scrollbar for text areas if needed */
        ::-webkit-scrollbar { width: 0px; }

        /* Cinematic Pulse */
        @keyframes cinematicPulse {
            0%, 100% { opacity: 0.8; transform: scale(1); filter: blur(0px); }
            50% { opacity: 1; transform: scale(1.02); filter: blur(1px); }
        }
        .cinematic-pulse {
            animation: cinematicPulse 8s ease-in-out infinite;
        }

        /* Cinematic Text Reveal - COMPLETE FLASH FIX */
        .smooth-text {
            opacity: 0 !important;
            visibility: hidden !important;
            pointer-events: none !important;
            /* Ensure text stays completely hidden until animation starts */
            color: transparent !important;
            text-shadow: none !important;
        }
        
        .smooth-text.staged-visible {
            opacity: 1 !important;
            visibility: visible !important;
            pointer-events: auto !important;
            color: inherit !important;
            text-shadow: inherit !important;
        }
        
        .smooth-text span {
            display: inline-block;
            opacity: 0 !important;
            transform: translateY(100px) scale(0.8) !important;
            filter: blur(50px) brightness(0) !important;
            transform-origin: bottom center;
            transition: all 1.6s cubic-bezier(0.16, 1, 0.3, 1) !important;
            will-change: transform, opacity, filter;
        }

        .smooth-text span.visible {
            opacity: 1 !important;
            transform: translateY(0) scale(1) !important;
            filter: blur(0) brightness(1) !important;
        }
        
        .smooth-text span.space {
            display: inline-block;
            width: 0.3em;
        }
        
        /* All other content starts hidden */
        .reveal-content {
            opacity: 0;
            visibility: hidden;
            transform: translateY(40px);
            filter: blur(10px);
            transition: all 1.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        .reveal-content.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
            filter: blur(0);
        }

        /* --- CINEMATIC OVERHAUL --- */
        /* Letterboxing (2.35:1 Aspect Ratio) */
        .letterbox {
            position: fixed;
            left: 0;
            width: 100%;
            height: 12vh;
            background: black;
            z-index: 100;
            transition: transform 2s cubic-bezier(0.86, 0, 0.07, 1);
            pointer-events: none;
        }
        .letterbox-top { top: 0; transform: translateY(-100%); }
        .letterbox-bottom { bottom: 0; transform: translateY(100%); }
        
        body.cinema-mode .letterbox-top { transform: translateY(0); }
        body.cinema-mode .letterbox-bottom { transform: translateY(0); }

        /* Safe Zone for Content */
        .safe-zone {
            padding-top: 12vh;
            padding-bottom: 12vh;
        }

        /* Cinematic slide entering/exiting animations */
        .slide.entering {
            opacity: 1 !important;
            pointer-events: all !important;
            transform: translateY(8px) scale(1) rotateX(0deg) !important;
            filter: blur(0) brightness(1) !important;
            transition: transform 900ms cubic-bezier(0.22, 1, 0.36, 1), opacity 900ms ease, filter 700ms ease;
            z-index: 20 !important;
        }

        .slide.exiting-left {
            transform: translateX(-12%) scale(0.98) rotateY(6deg) !important;
            opacity: 0 !important;
            filter: blur(6px) brightness(0.6) grayscale(0.2) !important;
            transition: transform 900ms cubic-bezier(0.22, 1, 0.36, 1), opacity 700ms ease, filter 700ms ease;
            z-index: 5 !important;
        }

        .slide.exiting-right {
            transform: translateX(12%) scale(0.98) rotateY(-6deg) !important;
            opacity: 0 !important;
            filter: blur(6px) brightness(0.6) grayscale(0.2) !important;
            transition: transform 900ms cubic-bezier(0.22, 1, 0.36, 1), opacity 700ms ease, filter 700ms ease;
            z-index: 5 !important;
        }

        /* Disappearing animation applied before switching slides */
        .slide.disappearing {
            transform: translateY(-8%) scale(0.96) !important;
            opacity: 0 !important;
            filter: blur(10px) brightness(0.45) !important;
            /* extended, more cinematic disappearance */
            transition: transform 2000ms cubic-bezier(0.22, 1, 0.36, 1), opacity 2000ms ease, filter 2000ms ease;
            z-index: 25 !important;
        }

        /* Content-only disappearing (titles, subtitles, stats, galleries) */
        .slide.content-disappear .reveal-text,
        .slide.content-disappear .reveal-content {
            opacity: 0 !important;
            transform: translateY(24px) !important;
            filter: blur(8px) !important;
            transition: transform 1200ms cubic-bezier(0.22,1,0.36,1), opacity 1200ms ease, filter 1200ms ease;
        }

        /* Smooth-text characters fade/slide out when content-disappear is active */
        .slide.content-disappear .smooth-text span.visible {
            opacity: 0 !important;
            transform: translateY(40px) scale(0.95) !important;
            filter: blur(12px) !important;
            transition: all 1200ms cubic-bezier(0.22,1,0.36,1);
        }

        /* Fade galleries slightly before full slide transition */
        .slide.content-disappear .gallery-stack,
        .slide.content-disappear .gallery-stack-family {
            opacity: 0 !important;
            transform: translateY(30px) scale(0.98) !important;
            transition: all 1000ms ease;
        }

        /* Production collage (small image grid in background) */
        #production-collage {
            position: absolute;
            inset: 0;
            z-index: 2; /* behind text which is z-10 */
            overflow: hidden; /* clip content that goes off-screen */
            pointer-events: none;
            opacity: 0.6;
            filter: saturate(38%) brightness(0.46) contrast(1.12);
        }

        /* Mobile collage (same style as production collage) */
        #mobile-collage {
            position: absolute;
            inset: 0;
            z-index: 1; /* behind content */
            overflow: hidden;
            pointer-events: none;
        }

        /* Wrapper for seamless looping - contains two identical grids side-by-side */
        #production-collage .collage-wrapper,
        #mobile-collage .collage-wrapper {
            display: flex;
            width: 200%; /* two grids side-by-side */
            height: 100%;
            will-change: transform;
            animation: endlessScrollRight 180s linear infinite;
        }

        /* Each grid section */
        #production-collage .collage-grid,
        #mobile-collage .collage-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(var(--tile-size, 64px), 1fr));
            gap: 4px;
            width: 50%; /* each grid takes half of wrapper (= full viewport width) */
            height: 100%;
            flex-shrink: 0;
        }

        #production-collage .prod-tile,
        #mobile-collage .prod-tile {
            width: var(--tile-size, 64px);
            height: var(--tile-size, 64px);
            background-size: cover;
            background-position: center;
            border-radius: 4px;
            box-shadow: inset 0 0 2px rgba(0,0,0,0.42);
        }

        /* Endless scroll: moves wrapper from 0 to -50% (one grid width), then resets seamlessly */
        @keyframes endlessScrollRight {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        /* Subtle parallax on active slide background during transition */
        .slide.active img.ken-burns {
            transition: transform 1200ms cubic-bezier(0.2, 1, 0.36, 1);
        }

        /* Cinematic flare overlay used during transitions */
        #cinematic-flare {
            pointer-events: none;
            position: fixed;
            inset: 0;
            z-index: 25000;
            opacity: 0;
            background: radial-gradient(1200px 400px at 10% 20%, rgba(255,255,255,0.06), transparent 20%),
                        linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.08) 50%, rgba(255,255,255,0.02));
            mix-blend-mode: screen;
            transition: opacity 600ms ease, transform 900ms ease;
        }
        #cinematic-flare.active { opacity: 1; transform: scale(1.02); transition: opacity 700ms ease; }


        /* Interactive Elements */
        .magnetic-btn {
            transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1);
        }
        
        /* Spotlight Effect */
        .spotlight-overlay {
            position: fixed;
            inset: 0;
            background: radial-gradient(circle 600px at var(--mouse-x, 50%) var(--mouse-y, 50%), rgba(255,255,255,0.07), transparent 50%);
            z-index: 30;
            pointer-events: none;
            mix-blend-mode: overlay;
        }

        /* Text Texture */
        .textured-text {
            background: linear-gradient(135deg, #fff 0%, #ccc 50%, #fff 100%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shine 8s linear infinite;
        }
        @keyframes shine { to { background-position: 200% center; } }

        /* Intro Overlay */
        #intro-overlay {
            position: fixed;
            inset: 0;
            background: black;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 2.5s ease-in-out, visibility 2.5s;
        }
        #intro-overlay.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        /* Subtle Pulse for Intro Text */
        .intro-pulse { animation: introPulse 3s infinite alternate; }
        @keyframes introPulse { from { opacity: 0.3; } to { opacity: 0.8; } }

        /* --- INTERACTIVE GALLERY --- */
        .gallery-stack {
            position: fixed;
            width: 180px;
            height: 260px;
            z-index: 50;
            perspective: 1000px;
            pointer-events: auto;
            opacity: 0;
            visibility: hidden;
            transition: opacity 1s cubic-bezier(0.2, 0.8, 0.2, 1), visibility 1s;
            display: none;
            cursor: grab;
            touch-action: none;
            user-select: none;
        }
        
        .gallery-stack.long-press-active {
            cursor: grabbing !important;
            transform: scale(1.05);
            box-shadow: 0 20px 50px rgba(255,255,255,0.2);
        }
        
        .gallery-stack.dragging {
            transition: none !important;
            cursor: grabbing !important;
            transform: scale(1.05);
        }
        
        .gallery-stack.dragging .gallery-card {
            pointer-events: none;
        }
        
        /* Family Gallery Stack */
        .gallery-stack-family {
            position: fixed;
            width: 160px;
            height: 220px;
            z-index: 50;
            perspective: 1000px;
            pointer-events: auto;
            opacity: 0;
            visibility: hidden;
            transition: opacity 1s cubic-bezier(0.2, 0.8, 0.2, 1), visibility 1s;
            display: none;
            cursor: grab;
            touch-action: none;
            user-select: none;
        }
        
        .gallery-stack-family.long-press-active {
            cursor: grabbing !important;
            transform: scale(1.05);
            box-shadow: 0 20px 50px rgba(255,255,255,0.2);
        }
        
        .gallery-stack-family.dragging {
            transition: none !important;
            cursor: grabbing !important;
            transform: scale(1.05);
        }
        
        .gallery-stack-family.dragging .gallery-card {
            pointer-events: none;
        }

        @media (min-width: 1024px) { 
            .gallery-stack, .gallery-stack-family { display: block; } 
        }
        
        .gallery-stack.visible, .gallery-stack-family.visible {
            opacity: 1;
            visibility: visible;
        }
        
        /* Slide-specific positioning based on content layout */
        /* Slide 1 (Intro): Center content - galleries on sides */
        .slide[data-index="0"] .gallery-stack {
            right: 5%;
            top: 30%;
        }
        .slide[data-index="0"] .gallery-stack-family {
            left: 5%;
            top: 30%;
        }
        
        /* Slide 2 (Thailand): Bottom-left content - galleries on right */
        .slide[data-index="1"] .gallery-stack {
            right: 5%;
            top: 15%;
        }
        .slide[data-index="1"] .gallery-stack-family {
            right: 5%;
            top: 50%;
        }
        
        /* Slide 3 (Tenerife): Left content - galleries on right */
        .slide[data-index="2"] .gallery-stack {
            right: 5%;
            top: 20%;
        }
        .slide[data-index="2"] .gallery-stack-family {
            right: 5%;
            bottom: 15%;
            top: auto;
        }
        
        /* Slide 4 (Switzerland): Center content - galleries on sides */
        .slide[data-index="3"] .gallery-stack {
            right: 5%;
            bottom: 15%;
            top: auto;
        }
        .slide[data-index="3"] .gallery-stack-family {
            left: 5%;
            bottom: 15%;
            top: auto;
        }
        
        /* Slide 5 (Germany): Right content - galleries on left */
        .slide[data-index="4"] .gallery-stack {
            left: 5%;
            top: 20%;
        }
        .slide[data-index="4"] .gallery-stack-family {
            left: 5%;
            bottom: 15%;
            top: auto;
        }
        
        .gallery-card {
            position: absolute;
            inset: 0;
            border-radius: 8px;
            background-size: cover;
            background-position: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 3px solid rgba(255,255,255,0.9);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: zoom-in;
            transform-origin: center bottom;
        }

        /* Stacked State */
        .gallery-card:nth-child(1) { transform: rotate(-10deg) translate(-10px, -5px); z-index: 5; }
        .gallery-card:nth-child(2) { transform: rotate(-5deg) translate(-5px, -2px); z-index: 4; }
        .gallery-card:nth-child(3) { transform: rotate(0deg) translate(0px, 0px); z-index: 3; }
        .gallery-card:nth-child(4) { transform: rotate(5deg) translate(5px, 2px); z-index: 2; }
        .gallery-card:nth-child(5) { transform: rotate(10deg) translate(10px, 5px); z-index: 1; }

        /* Hover Fan Effect - "Rollable" feel - DISABLED during long press */
        .gallery-stack:hover:not(.long-press-active):not(.dragging) .gallery-card:nth-child(1), 
        .gallery-stack-family:hover:not(.long-press-active):not(.dragging) .gallery-card:nth-child(1) { 
            transform: translate(-100%, 10%) rotate(-15deg); 
        }
        .gallery-stack:hover:not(.long-press-active):not(.dragging) .gallery-card:nth-child(2), 
        .gallery-stack-family:hover:not(.long-press-active):not(.dragging) .gallery-card:nth-child(2) { 
            transform: translate(-50%, 2%) rotate(-8deg); 
        }
        .gallery-stack:hover:not(.long-press-active):not(.dragging) .gallery-card:nth-child(3), 
        .gallery-stack-family:hover:not(.long-press-active):not(.dragging) .gallery-card:nth-child(3) { 
            transform: translate(0%, 0%) rotate(0deg); 
        }
        .gallery-stack:hover:not(.long-press-active):not(.dragging) .gallery-card:nth-child(4), 
        .gallery-stack-family:hover:not(.long-press-active):not(.dragging) .gallery-card:nth-child(4) { 
            transform: translate(50%, 2%) rotate(8deg); 
        }
        .gallery-stack:hover:not(.long-press-active):not(.dragging) .gallery-card:nth-child(5), 
        .gallery-stack-family:hover:not(.long-press-active):not(.dragging) .gallery-card:nth-child(5) { 
            transform: translate(100%, 10%) rotate(15deg); 
        }
        
        /* Reset stacked state when dragging */
        .gallery-stack.long-press-active .gallery-card,
        .gallery-stack.dragging .gallery-card,
        .gallery-stack-family.long-press-active .gallery-card,
        .gallery-stack-family.dragging .gallery-card {
            transform: rotate(-10deg) translate(-10px, -5px) !important;
        }
        
        .gallery-stack.long-press-active .gallery-card:nth-child(1),
        .gallery-stack-family.long-press-active .gallery-card:nth-child(1),
        .gallery-stack.dragging .gallery-card:nth-child(1),
        .gallery-stack-family.dragging .gallery-card:nth-child(1) {
            transform: rotate(-10deg) translate(-10px, -5px) !important;
        }
        
        .gallery-stack.long-press-active .gallery-card:nth-child(2),
        .gallery-stack-family.long-press-active .gallery-card:nth-child(2),
        .gallery-stack.dragging .gallery-card:nth-child(2),
        .gallery-stack-family.dragging .gallery-card:nth-child(2) {
            transform: rotate(-5deg) translate(-5px, -2px) !important;
        }
        
        .gallery-stack.long-press-active .gallery-card:nth-child(3),
        .gallery-stack-family.long-press-active .gallery-card:nth-child(3),
        .gallery-stack.dragging .gallery-card:nth-child(3),
        .gallery-stack-family.dragging .gallery-card:nth-child(3) {
            transform: rotate(0deg) translate(0px, 0px) !important;
        }
        
        .gallery-stack.long-press-active .gallery-card:nth-child(4),
        .gallery-stack-family.long-press-active .gallery-card:nth-child(4),
        .gallery-stack.dragging .gallery-card:nth-child(4),
        .gallery-stack-family.dragging .gallery-card:nth-child(4) {
            transform: rotate(5deg) translate(5px, 2px) !important;
        }
        
        .gallery-stack.long-press-active .gallery-card:nth-child(5),
        .gallery-stack-family.long-press-active .gallery-card:nth-child(5),
        .gallery-stack.dragging .gallery-card:nth-child(5),
        .gallery-stack-family.dragging .gallery-card:nth-child(5) {
            transform: rotate(10deg) translate(10px, 5px) !important;
        }

        /* Smart Spacing on Hover (Fisheye Effect) - Only when not dragging */
        .gallery-stack:hover:not(.long-press-active):not(.dragging) .gallery-card:has(~ .gallery-card:hover), 
        .gallery-stack-family:hover:not(.long-press-active):not(.dragging) .gallery-card:has(~ .gallery-card:hover) {
            transform: translateX(-60px) scale(0.9) !important;
            filter: brightness(0.5) blur(2px);
        }
        .gallery-stack:hover:not(.long-press-active):not(.dragging) .gallery-card:hover ~ .gallery-card, 
        .gallery-stack-family:hover:not(.long-press-active):not(.dragging) .gallery-card:hover ~ .gallery-card {
            transform: translateX(60px) scale(0.9) !important;
            filter: brightness(0.5) blur(2px);
        }

        /* Pop out the specific card being hovered - Only when not dragging */
        .gallery-stack:hover:not(.long-press-active):not(.dragging) .gallery-card:hover, 
        .gallery-stack-family:hover:not(.long-press-active):not(.dragging) .gallery-card:hover {
            transform: translateY(-40px) scale(1.2) rotate(0deg) !important;
            z-index: 50 !important;
            box-shadow: 0 30px 60px rgba(0,0,0,0.8);
            border-color: #fff;
            filter: brightness(1.1);
        }

        /* Drag mode overlay - blur/dim everything except active deck */
        #drag-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: 45;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        #drag-overlay.active {
            opacity: 1;
            pointer-events: auto; /* block underlying content while active */
        }

        /* Use overlay backdrop-filter where supported to blur the backdrop.
           Avoid applying filters to ancestor elements (which would blur descendants).
           We ensure the active stack is repositioned above the overlay during drag so
           it remains fully visible and unblurred across browsers. */
        /* gallery stacks will be given a very high z-index while dragging via inline styles */
        
        .gallery-stack.long-press-active,
        .gallery-stack-family.long-press-active {
            z-index: 200 !important;
            filter: brightness(1.1);
        }
        
        .gallery-stack.dragging,
        .gallery-stack-family.dragging {
            z-index: 200 !important;
            transition: none !important;
        }

        /* When lightbox is open, hide other UI to keep the view clean */
    body.lightbox-open #nav-controls,
        body.lightbox-open .letterbox,
        body.lightbox-open #progress,
        body.lightbox-open .gallery-stack,
        body.lightbox-open .gallery-stack-family,
        body.lightbox-open #dust-container {
            opacity: 0 !important;
            pointer-events: none !important;
            transform: translateY(10px);
        }

        /* ensure cursor remains visible while lightbox open */
        body.lightbox-open #cursor,
        body.lightbox-open #cursor-dot { display: block !important; }

        /* Discover Place Modal */
        .discover-modal {
            position: fixed;
            inset: 0;
            z-index: 15000;
            background: linear-gradient(180deg, rgba(0,0,0,0.98), rgba(5,5,15,0.98));
            backdrop-filter: blur(40px) saturate(80%);
            opacity: 0;
            pointer-events: none;
            transition: opacity 1200ms cubic-bezier(0.22, 1, 0.36, 1);
            overflow-y: auto;
            overflow-x: hidden;
        }

        .discover-modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .discover-modal::before {
            content: '';
            position: fixed;
            inset: 0;
            background: 
                radial-gradient(circle at 30% 20%, rgba(20,20,40,0.4), transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(15,15,30,0.4), transparent 50%);
            pointer-events: none;
            animation: subtleBreath 12s ease-in-out infinite;
        }

        @keyframes subtleBreath {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.5; }
        }

        .discover-modal::-webkit-scrollbar { width: 6px; }
        .discover-modal::-webkit-scrollbar-track { 
            background: rgba(0,0,0,0.5);
        }
        .discover-modal::-webkit-scrollbar-thumb { 
            background: rgba(255,255,255,0.15);
            border-radius: 3px;
        }
        .discover-modal::-webkit-scrollbar-thumb:hover { 
            background: rgba(255,255,255,0.25);
        }

        .discover-content {
            max-width: 1600px;
            margin: 0 auto;
            padding: 8vh 6vw 12vh;
            transform: translateY(40px);
            opacity: 0;
            transition: all 1200ms cubic-bezier(0.16, 1, 0.3, 1);
        }

        .discover-modal.active .discover-content {
            transform: translateY(0);
            opacity: 1;
            transition-delay: 400ms;
        }

        /* Cinematic Hero Section */
        .discover-hero {
            position: relative;
            height: 75vh;
            border-radius: 0;
            overflow: hidden;
            margin-bottom: 100px;
            box-shadow: 
                0 50px 120px rgba(0,0,0,0.8),
                0 0 0 1px rgba(255,255,255,0.03) inset;
        }

        .discover-hero::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(
                180deg,
                rgba(0,0,0,0.1) 0%,
                rgba(0,0,0,0.5) 60%,
                rgba(0,0,0,0.95) 100%
            );
            pointer-events: none;
        }

        .discover-hero img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scale(1.1);
            filter: saturate(80%) contrast(1.1);
            transition: transform 25s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .discover-modal.active .discover-hero img {
            transform: scale(1);
        }

        .discover-hero-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 80px;
            z-index: 10;
        }

        .discover-subtitle {
            display: inline-block;
            padding: 10px 28px;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 50px;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 0.35em;
            text-transform: uppercase;
            color: rgba(255,255,255,0.5);
            margin-bottom: 32px;
        }

        .discover-title {
            font-size: clamp(4rem, 10vw, 11rem);
            font-weight: 900;
            line-height: 0.88;
            letter-spacing: -0.04em;
            background: linear-gradient(180deg, #ffffff 0%, rgba(255,255,255,0.4) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 40px rgba(0,0,0,0.8);
            margin-bottom: 40px;
            font-family: 'Playfair Display', serif;
            font-style: italic;
        }

        .discover-description {
            font-size: 22px;
            font-weight: 300;
            line-height: 1.7;
            color: rgba(255,255,255,0.7);
            max-width: 900px;
            text-shadow: 0 2px 30px rgba(0,0,0,0.8);
        }

        .discover-btn {
            display: inline-flex;
            align-items: center;
            gap: 14px;
            padding: 20px 44px;
            background: rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 50px;
            color: white;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 0.25em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 600ms cubic-bezier(0.34, 1.56, 0.64, 1);
            backdrop-filter: blur(30px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
            position: relative;
            overflow: hidden;
        }

        .discover-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(255,255,255,0.05);
            opacity: 0;
            transition: opacity 600ms;
        }

        .discover-btn:hover::before {
            opacity: 1;
        }

        .discover-btn:hover {
            border-color: rgba(255,255,255,0.3);
            transform: translateY(-4px);
            box-shadow: 0 20px 60px rgba(0,0,0,0.6);
        }

        .discover-btn svg {
            transition: transform 600ms cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            z-index: 1;
        }

        .discover-btn:hover svg {
            transform: translateX(-4px);
        }

        .discover-btn span {
            position: relative;
            z-index: 1;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 32px;
            margin: 80px 0 120px;
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
            gap: 32px;
            margin: 80px 0;
        }

        .photo-grid-item {
            position: relative;
            aspect-ratio: 3/2;
            border-radius: 0;
            overflow: hidden;
            cursor: pointer;
            transition: all 700ms cubic-bezier(0.23, 1, 0.32, 1);
            box-shadow: 
                0 20px 60px rgba(0,0,0,0.7),
                0 0 0 1px rgba(255,255,255,0.03) inset;
        }

        .photo-grid-item::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(
                180deg,
                transparent 0%,
                rgba(0,0,0,0.3) 100%
            );
            opacity: 0;
            transition: opacity 700ms;
            z-index: 2;
        }

        .photo-grid-item:hover::before {
            opacity: 1;
        }

        .photo-grid-item:hover {
            transform: translateY(-8px);
            box-shadow: 
                0 40px 100px rgba(0,0,0,0.8),
                0 0 0 1px rgba(255,255,255,0.08) inset;
        }

        .photo-grid-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: saturate(80%);
            transition: transform 1000ms cubic-bezier(0.23, 1, 0.32, 1), filter 700ms;
        }

        .photo-grid-item:hover img {
            transform: scale(1.08);
            filter: saturate(100%);
        }

        .stat-card {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 0;
            padding: 48px;
            backdrop-filter: blur(40px);
            transition: all 600ms cubic-bezier(0.23, 1, 0.32, 1);
            position: relative;
        }

        .stat-card:hover {
            background: rgba(255,255,255,0.04);
            border-color: rgba(255,255,255,0.12);
            transform: translateY(-6px);
            box-shadow: 0 30px 80px rgba(0,0,0,0.6);
        }

        .timeline-item {
            position: relative;
            padding-left: 80px;
            padding-bottom: 80px;
            border-left: 1px solid rgba(255,255,255,0.08);
        }

        .timeline-item:last-child {
            border-left-color: transparent;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -5px;
            top: 0;
            width: 9px;
            height: 9px;
            background: rgba(255,255,255,0.8);
            border-radius: 50%;
            box-shadow: 0 0 0 3px rgba(0,0,0,0.8);
            transition: all 500ms;
        }

        .timeline-item:hover::before {
            transform: scale(1.5);
            background: white;
            box-shadow: 
                0 0 0 4px rgba(0,0,0,0.8),
                0 0 20px rgba(255,255,255,0.4);
        }

        .timeline-item::after {
            content: '';
            position: absolute;
            left: -0.5px;
            top: 9px;
            bottom: 0;
            width: 1px;
            background: linear-gradient(180deg, rgba(255,255,255,0.15), transparent);
        }

        .highlight-text {
            background: rgba(255,255,255,0.03);
            padding: 6px 16px;
            border-radius: 6px;
            display: inline-block;
            border-left: 3px solid rgba(255,255,255,0.2);
        }

        /* Section Headers */
        .section-header {
            font-size: clamp(2.5rem, 5vw, 4.5rem);
            font-weight: 900;
            margin-bottom: 80px;
            background: linear-gradient(180deg, #ffffff 0%, rgba(255,255,255,0.3) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-family: 'Playfair Display', serif;
            font-style: italic;
            position: relative;
            display: inline-block;
            letter-spacing: -0.02em;
        }

        .section-header::after {
            content: '';
            position: absolute;
            bottom: -24px;
            left: 0;
            width: 80px;
            height: 2px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
            gap: 32px;
            margin: 80px 0;
        }

        .photo-grid-item {
            position: relative;
            aspect-ratio: 3/2;
            border-radius: 0;
            overflow: hidden;
            cursor: pointer;
            transition: all 700ms cubic-bezier(0.23, 1, 0.32, 1);
            box-shadow: 
                0 20px 60px rgba(0,0,0,0.7),
                0 0 0 1px rgba(255,255,255,0.03) inset;
        }

        .photo-grid-item::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(
                180deg,
                transparent 0%,
                rgba(0,0,0,0.3) 100%
            );
            opacity: 0;
            transition: opacity 700ms;
            z-index: 2;
        }

        .photo-grid-item:hover::before {
            opacity: 1;
        }

        .photo-grid-item:hover {
            transform: translateY(-8px);
            box-shadow: 
                0 40px 100px rgba(0,0,0,0.8),
                0 0 0 1px rgba(255,255,255,0.08) inset;
        }

        .photo-grid-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: saturate(80%);
            transition: transform 1000ms cubic-bezier(0.23, 1, 0.32, 1), filter 700ms;
        }

        .photo-grid-item:hover img {
            transform: scale(1.08);
            filter: saturate(100%);
        }

        .stat-card {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 0;
            padding: 48px;
            backdrop-filter: blur(40px);
            transition: all 600ms cubic-bezier(0.23, 1, 0.32, 1);
            position: relative;
        }

        .stat-card:hover {
            background: rgba(255,255,255,0.04);
            border-color: rgba(255,255,255,0.12);
            transform: translateY(-6px);
            box-shadow: 0 30px 80px rgba(0,0,0,0.6);
        }

        .timeline-item {
            position: relative;
            padding-left: 80px;
            padding-bottom: 80px;
            border-left: 1px solid rgba(255,255,255,0.08);
        }

        .timeline-item:last-child {
            border-left-color: transparent;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -5px;
            top: 0;
            width: 9px;
            height: 9px;
            background: rgba(255,255,255,0.8);
            border-radius: 50%;
            box-shadow: 0 0 0 3px rgba(0,0,0,0.8);
            transition: all 500ms;
        }

        .timeline-item:hover::before {
            transform: scale(1.5);
            background: white;
            box-shadow: 
                0 0 0 4px rgba(0,0,0,0.8),
                0 0 20px rgba(255,255,255,0.4);
        }

        .timeline-item::after {
            content: '';
            position: absolute;
            left: -0.5px;
            top: 9px;
            bottom: 0;
            width: 1px;
            background: linear-gradient(180deg, rgba(255,255,255,0.15), transparent);
        }

        .highlight-text {
            background: rgba(255,255,255,0.03);
            padding: 6px 16px;
            border-radius: 6px;
            display: inline-block;
            border-left: 3px solid rgba(255,255,255,0.2);
        }

        /* Section Headers */
        .section-header {
            font-size: clamp(2.5rem, 5vw, 4.5rem);
            font-weight: 900;
            margin-bottom: 80px;
            background: linear-gradient(180deg, #ffffff 0%, rgba(255,255,255,0.3) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-family: 'Playfair Display', serif;
            font-style: italic;
            position: relative;
            display: inline-block;
            letter-spacing: -0.02em;
        }

        .section-header::after {
            content: '';
            position: absolute;
            bottom: -24px;
            left: 0;
            width: 80px;
            height: 2px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
        }

        /* Enhanced parallax depth layers */
        .parallax-layer-1 { transform: translateZ(-100px) scale(1.5); }
        .parallax-layer-2 { transform: translateZ(-200px) scale(2); }
        .parallax-layer-3 { transform: translateZ(-300px) scale(2.5); }

        /* Interactive hover glow */
        .glow-on-hover {
            position: relative;
            overflow: hidden;
        }

        .glow-on-hover::before {
            content: '';
            position: absolute;
            inset: -2px;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            opacity: 0;
            transition: opacity 0.5s;
        }

        .glow-on-hover:hover::before {
            opacity: 1;
            animation: glow-rotate 2s linear infinite;
        }

        @keyframes glow-rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Cinematic zoom effect on images */
        .zoom-on-hover {
            overflow: hidden;
            position: relative;
        }

        .zoom-on-hover img {
            transition: transform 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .zoom-on-hover:hover img {
            transform: scale(1.15) rotate(2deg);
        }

        /* Smooth entrance animations for modal content */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(60px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-slide-in {
            animation: slideInUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        /* Stagger animation for grid items */
        .stagger-item {
            opacity: 0;
            animation: slideInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        .stagger-item:nth-child(1) { animation-delay: 0.1s; }
        .stagger-item:nth-child(2) { animation-delay: 0.2s; }
        .stagger-item:nth-child(3) { animation-delay: 0.3s; }
        .stagger-item:nth-child(4) { animation-delay: 0.4s; }
        .stagger-item:nth-child(5) { animation-delay: 0.5s; }
        .stagger-item:nth-child(6) { animation-delay: 0.6s; }
        .stagger-item:nth-child(7) { animation-delay: 0.7s; }
        .stagger-item:nth-child(8) { animation-delay: 0.8s; }

        /* Enhanced text shadows for depth */
        .text-depth {
            text-shadow: 
                0 1px 0 rgba(0,0,0,0.3),
                0 2px 2px rgba(0,0,0,0.2),
                0 4px 4px rgba(0,0,0,0.1),
                0 8px 8px rgba(0,0,0,0.05),
                0 16px 16px rgba(0,0,0,0.025);
        }

        /* Floating animation for interactive elements */
        @keyframes floatSlow {
            0%, 100% { transform: translateY(0) translateX(0); }
            25% { transform: translateY(-8px) translateX(4px); }
            50% { transform: translateY(-4px) translateX(-4px); }
            75% { transform: translateY(-12px) translateX(2px); }
        }

        .float-slow {
            animation: floatSlow 8s ease-in-out infinite;
        }

        /* Subtle breathing effect - removed glow */
        @keyframes subtleBreath {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.95; }
        }

        .breathe-glow {
            animation: subtleBreath 6s ease-in-out infinite;
        }

        /* Screen wipe effect for modal entrance */
        @keyframes wipeIn {
            from {
                opacity: 0;
                transform: scale(0.98);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .discover-modal.active .discover-content {
            animation: wipeIn 800ms cubic-bezier(0.23, 1, 0.32, 1);
        }

        /* Particle effect overlay - subdued */
        .discover-modal::after {
            content: '';
            position: fixed;
            inset: 0;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(255,255,255,0.02) 1px, transparent 1px),
                radial-gradient(circle at 80% 20%, rgba(255,255,255,0.02) 1px, transparent 1px),
                radial-gradient(circle at 40% 80%, rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 50px 50px, 70px 70px, 60px 60px;
            background-position: 0 0, 30px 30px, 15px 15px;
            opacity: 0.2;
            pointer-events: none;
            animation: particleFloat 60s linear infinite;
        }

        @keyframes particleFloat {
            0% { transform: translateY(0); }
            100% { transform: translateY(-100px); }
        }

        /* Enhanced section divider */
        .section-divider {
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
            margin: 80px 0;
            position: relative;
        }



        /* Immersive highlight cards */
        .highlight-card {
            position: relative;
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 0;
            padding: 48px;
            backdrop-filter: blur(30px);
            overflow: hidden;
            transition: all 600ms cubic-bezier(0.23, 1, 0.32, 1);
        }

        .highlight-card:hover {
            background: rgba(255,255,255,0.03);
            border-color: rgba(255,255,255,0.1);
            transform: translateY(-4px);
        }

        /* Gallery selector modal (appears when user taps a stack) */
        #gallery-selector {
            position: fixed;
            inset: 0;
            z-index: 21000;
            display: none;
            align-items: center;
            justify-content: center;
            background: linear-gradient(180deg, rgba(0,0,0,0.85), rgba(0,0,0,0.95));
            backdrop-filter: blur(6px) saturate(120%);
            padding: 40px;
        }
        #gallery-selector.visible { display: flex; }

        #gallery-selector .selector-card {
            max-width: 1100px;
            width: 100%;
            display: flex;
            gap: 24px;
            align-items: center;
            justify-content: center;
            pointer-events: auto;
        }

        #gallery-selector .thumbs {
            display: flex;
            gap: 12px;
            align-items: center;
            justify-content: center;
            overflow-x: auto;
            padding: 8px;
            max-width: 100%;
        }

        #gallery-selector .thumb {
            width: 110px;
            height: 70px;
            background-size: cover;
            background-position: center;
            border-radius: 6px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6);
            cursor: pointer;
            transform-origin: center;
            transition: transform 220ms cubic-bezier(0.2,0.9,0.3,1), box-shadow 220ms;
            border: 2px solid rgba(255,255,255,0.06);
        }
        #gallery-selector .thumb:hover { transform: translateY(-6px) scale(1.04); box-shadow:0 20px 40px rgba(0,0,0,0.7); border-color: rgba(255,255,255,0.18); }

        #gallery-selector .thumb.active {
            transform: translateY(-14px) scale(1.12);
            border-color: white;
            box-shadow: 0 30px 80px rgba(0,0,0,0.8);
        }

        /* Lightbox nav buttons */
        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            z-index: 21001;
            transition: background 200ms, transform 150ms;
        }
        .lightbox-nav:hover { background: rgba(255,255,255,0.06); transform: scale(1.05); }
        .lightbox-nav.left { left: 24px; }
        .lightbox-nav.right { right: 24px; }

        /* Shared-element clone used for smooth expand/contract animation */
        .transition-clone {
            position: fixed;
            object-fit: cover;
            z-index: 22000;
            border-radius: 8px;
            will-change: transform, width, height, left, top;
            box-shadow: 0 30px 80px rgba(0,0,0,0.6);
            transition: all 520ms cubic-bezier(0.2, 0.9, 0.2, 1);
        }
    </style>
</head>
<body class="bg-black text-white overflow-hidden h-screen w-screen selection:bg-blue-500 selection:text-white" id="app-body">

    <!-- Mobile Warning Overlay -->
    <div id="mobile-warning" class="fixed inset-0 z-[30000] bg-black flex flex-col items-center justify-center text-center px-6 lg:hidden">
        <!-- Rolling grid background (only visible on message screen) -->
        <div id="mobile-collage" class="absolute inset-0 opacity-0 overflow-hidden pointer-events-none transition-opacity duration-1000" style="filter: saturate(38%) brightness(0.46) contrast(1.12);" aria-hidden="true"></div>
        
        <!-- Access code screen (shown first) - pure black background -->
        <div id="mobile-access" class="max-w-md relative z-10">
            <p class="text-gray-500 text-xs uppercase tracking-[0.5em] mb-12 font-light">Secure Access</p>
            <div class="relative group">
                <input type="password" id="mobile-access-code" maxlength="4" class="bg-transparent border-b border-white/20 text-center text-4xl text-white font-serif tracking-[1em] w-64 py-4 focus:outline-none focus:border-white/60 transition-all placeholder-white/5" placeholder="••••" onkeyup="checkMobileAccess(this)" autocomplete="off">
                <div class="absolute bottom-0 left-0 w-0 h-px bg-white transition-all duration-500 group-hover:w-full"></div>
            </div>
            <p id="mobile-access-error" class="text-red-500 text-[10px] uppercase tracking-widest mt-6 opacity-0 transition-opacity duration-300 font-light">Invalid Passcode</p>
        </div>
        
        <!-- Message screen (shown after correct code) -->
        <div id="mobile-message" class="max-w-md relative z-10 hidden">
            <div class="absolute -top-24 left-1/2 -translate-x-1/2 w-px h-16 bg-gradient-to-b from-transparent to-white/30"></div>
            <h2 class="text-3xl font-serif italic text-white mb-6 tracking-wide">Szedrek 2025 Recap</h2>
            <p class="text-gray-400 text-xs uppercase tracking-[0.2em] leading-loose mb-8">
                This journey requires a wider canvas.<br>
                Please use a desktop or tablet.
            </p>
            <div class="flex items-center justify-center gap-4 opacity-50">
                <div class="w-8 h-px bg-white/20"></div>
                <span class="text-[10px] uppercase tracking-widest text-white/40">Available on Larger Screens</span>
                <div class="w-8 h-px bg-white/20"></div>
            </div>
        </div>
    </div>

    <!-- Access Gate -->
    <div id="access-gate" class="fixed inset-0 z-[20000] bg-black flex flex-col items-center justify-center transition-all duration-1000">
        <div class="text-center relative">
            <p class="text-gray-500 text-xs uppercase tracking-[0.5em] mb-12 font-light">Secure Access</p>
            <div class="relative group">
                <input type="password" id="access-code" maxlength="4" class="bg-transparent border-b border-white/20 text-center text-5xl text-white font-serif tracking-[1em] w-80 py-4 focus:outline-none focus:border-white/60 transition-all placeholder-white/5" placeholder="••••" onkeyup="checkAccess(this)" autocomplete="off">
                <div class="absolute bottom-0 left-0 w-0 h-px bg-white transition-all duration-500 group-hover:w-full"></div>
            </div>
            <p id="access-error" class="text-red-500 text-[10px] uppercase tracking-widest mt-6 opacity-0 transition-opacity duration-300 font-light">Invalid Passcode</p>
        </div>
    </div>

    <!-- Cinematic Audio -->
    <audio id="cinematic-audio" loop preload="auto">
        <!-- Placeholder: Replace with your own cinematic track -->
        <source src="https://cdn.pixabay.com/download/audio/2022/10/25/audio_4815250638.mp3" type="audio/mp3">
    </audio>

    <!-- Intro Overlay -->
    <div id="intro-overlay">
        <div class="text-center max-w-2xl px-6">
            <p class="text-xs md:text-sm font-serif italic text-gray-500 mb-8 tracking-[0.5em] uppercase intro-pulse"></p>
            <h1 class="text-5xl md:text-8xl font-black text-white mb-12 tracking-tighter uppercase mix-blend-difference leading-none">2025<br><span class="text-2xl md:text-4xl font-light tracking-widest opacity-70 block mt-4 font-serif normal-case italic"></span></h1>
            
            <button onclick="startExperience()" class="group relative px-12 py-5 bg-transparent border border-white/20 rounded-full overflow-hidden transition-all hover:border-white/60 hover:scale-105 hover:shadow-[0_0_30px_rgba(255,255,255,0.1)]">
                <div class="absolute inset-0 bg-white translate-y-full group-hover:translate-y-0 transition-transform duration-700 ease-in-out"></div>
                <span class="relative z-10 font-serif italic text-white group-hover:text-black transition-colors duration-700 tracking-widest text-sm">BEGIN</span>
            </button>
            
            <p class="mt-8 text-[10px] text-gray-600 uppercase tracking-widest"></p>
        </div>
    </div>

    <!-- Letterbox Bars -->
    <div class="letterbox letterbox-top"></div>
    <div class="letterbox letterbox-bottom"></div>

    <!-- Cinematic Overlays -->
    <div class="cinematic-grain"></div>
    <div class="cinematic-vignette"></div>
    <div class="spotlight-overlay"></div>
    <div id="cinematic-flare"></div>
    <div id="dust-container" class="fixed inset-0 pointer-events-none z-[15]"></div>
    
    <!-- Drag Overlay -->
    <div id="drag-overlay"></div>
    
    <!-- Lightbox Overlay -->
    <div id="lightbox-overlay" class="fixed inset-0 z-[20000] bg-black/95 backdrop-blur-xl opacity-0 pointer-events-none transition-opacity duration-500 flex items-center justify-center" onclick="closeAllLightboxes()">
        <div class="lightbox-nav left" onclick="event.stopPropagation(); prevLightbox();" aria-label="Previous"> 
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
        </div>
        <div class="lightbox-nav right" onclick="event.stopPropagation(); nextLightbox();" aria-label="Next"> 
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
        </div>
        <img id="lightbox-img" src="" class="max-w-[90vw] max-h-[90vh] object-contain shadow-[0_0_100px_rgba(0,0,0,0.8)] scale-90 transition-transform duration-700 ease-out" alt="Gallery Image">
        <button onclick="event.stopPropagation(); closeAllLightboxes();" class="absolute top-8 right-8 text-white/50 hover:text-white text-6xl font-thin transition-colors z-[21002]">&times;</button>
    </div>

    <!-- Gallery Selector Modal (thumbnails + preview) -->
    <div id="gallery-selector" aria-hidden="true">
        <div class="selector-card glass-card">
            <div class="selector-preview">
                <img id="selector-preview" src="" alt="Preview" onclick="openLightboxFromGallery(currentGalleryIndex)" class="max-w-[70vw] max-h-[70vh] object-contain shadow-[0_0_80px_rgba(0,0,0,0.8)] rounded-md">
            </div>
            <div class="thumbs" id="selector-thumbs" role="list"></div>
        </div>
    </div>

    <!-- Progress Bar -->
    <div class="fixed top-0 left-0 w-full h-1 bg-white/5 z-50">
        <div id="progress" class="h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 transition-all duration-700 ease-out shadow-[0_0_20px_rgba(59,130,246,0.5)]" style="width: 0%"></div>
    </div>

    <!-- Navigation Controls -->
    <div id="nav-controls" class="fixed bottom-[15vh] right-8 z-[110] flex gap-4 opacity-0 transition-opacity duration-1000 delay-1000 pointer-events-none">
        <button onclick="prevSlide()" class="magnetic-btn pointer-events-auto p-4 rounded-full bg-black/30 hover:bg-white/10 backdrop-blur border border-white/10 transition text-white disabled:opacity-30 disabled:cursor-not-allowed group hover:scale-110 active:scale-95" id="btn-prev">
            <svg class="w-6 h-6 group-hover:-translate-x-1 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
        </button>
        <button onclick="nextSlide()" class="magnetic-btn pointer-events-auto p-4 rounded-full bg-white text-black hover:bg-gray-200 transition shadow-[0_0_30px_rgba(255,255,255,0.3)] group hover:scale-110 active:scale-95" id="btn-next">
            <svg class="w-6 h-6 group-hover:translate-x-1 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
        </button>
    </div>

    <!-- Slide 1: Intro -->
    <div class="slide active" data-index="0" data-date="January 1, 2025">
        <div class="absolute inset-0 overflow-hidden">
            <img src="images/main/20250419_202310.jpg" class="w-full h-full object-cover opacity-60 ken-burns origin-center">
            <div class="absolute inset-0 bg-black/40"></div>
        </div>
        <div class="relative z-10 h-full flex flex-col justify-center items-center text-center px-4 safe-zone">
            <h1 class="text-[8rem] md:text-[16rem] font-black tracking-tighter leading-none text-white opacity-90 cinematic-pulse delay-100 smooth-text" style="opacity: 0 !important; visibility: hidden !important; color: transparent !important;">2025</h1>
            <p class="movie-title text-3xl md:text-5xl mt-8 text-white reveal-content">Szedrek 2025 Recap</p>
            
            <div class="mt-16 reveal-content">
                <button onclick="nextSlide()" class="magnetic-btn group flex items-center gap-4 text-white/80 hover:text-white transition-colors">
                    <span class="uppercase tracking-[0.3em] text-xs">Start Journey</span>
                    <div class="w-12 h-px bg-white/50 group-hover:w-20 transition-all duration-500"></div>
                </button>
            </div>
        </div>
    </div>

    <!-- Slide 2: Thailand -->
    <div class="slide" data-index="1" data-date="February 5-15, 2025">
        <div class="absolute inset-0 overflow-hidden">
            <img src="images/Thailand/main/20250212_091343.jpg" class="w-full h-full object-cover ken-burns origin-bottom">
            <div class="gradient-overlay-bottom"></div>
        </div>
        
        <!-- Gallery Stack -->
        <div class="gallery-stack">
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Thailand/landscape/20250206_184205.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Thailand/landscape/20250207_094342.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Thailand/landscape/20250207_094818.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Thailand/landscape/20250207_100425.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Thailand/landscape/20250207_101906.jpg')"></div>
        </div>

        <!-- Family Gallery Stack -->
        <div class="gallery-stack-family">
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Thailand/family/20250207_160623.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Thailand/family/20250207_194259.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Thailand/family/20250208_112510.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Thailand/family/20250209_104409.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Thailand/family/20250209_160456.jpg')"></div>
        </div>

        <div class="relative z-10 h-full flex flex-col justify-end px-8 md:px-24 safe-zone">
            <div class="max-w-4xl">
                <div class="flex items-baseline gap-6 mb-4 reveal-text">
                    <span class="chapter-number text-6xl md:text-8xl text-white">01</span>
                    <span class="movie-subtitle text-amber-300">Thailand</span>
                </div>
                <h2 class="movie-title text-6xl md:text-8xl text-white mb-8 leading-none smooth-text" style="opacity: 0 !important; visibility: hidden !important; color: transparent !important;">Thailand</h2>
                
                <div class="grid grid-cols-4 gap-8 mt-12 reveal-content border-t border-white/20 pt-8">
                    <div class="text-center md:text-left">
                        <p class="text-3xl font-bold text-white airport-text" data-text="Feb 5-15">FEB 5-15</p>
                        <p class="text-[10px] uppercase tracking-widest text-gray-400">2025</p>
                    </div>
                    <div class="text-center md:text-left">
                        <p class="text-3xl font-bold text-white airport-text" data-text="11">0</p>
                        <p class="text-[10px] uppercase tracking-widest text-gray-400">Days</p>
                    </div>
                    <div class="text-center md:text-left">
                        <p class="text-3xl font-bold text-white airport-text" data-text="∞">0</p>
                        <p class="text-[10px] uppercase tracking-widest text-gray-400">Endless Pad Thai</p>
                    </div>
                    <div class="text-center md:text-left">
                        <p class="text-3xl font-bold text-white airport-text" data-text="∞">0</p>
                        <p class="text-[10px] uppercase tracking-widest text-gray-400">Endless Temples</p>
                    </div>
                </div>

                <div class="mt-12 reveal-content">
                    <button onclick="openDiscoverModal('thailand')" class="discover-btn">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path>
                        </svg>
                        Discover Thailand
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Slide 3: Tenerife -->
    <div class="slide" data-index="2" data-date="April 18-26, 2025">
        <div class="absolute inset-0 bg-blue-950 overflow-hidden">
            <img src="images/Tenerife/main/20250419_202034.jpg" class="w-full h-full object-cover opacity-80 ken-burns origin-left">
            <div class="gradient-overlay-left"></div>
        </div>

        <!-- Gallery Stack -->
        <div class="gallery-stack">
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Tenerife/landscape/1000091123.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Tenerife/landscape/1000091445.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Tenerife/landscape/20250419_202034.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Tenerife/landscape/20250420_145047.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Tenerife/landscape/20250420_151541.jpg')"></div>
        </div>

        <!-- Family Gallery Stack -->
        <div class="gallery-stack-family">
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Tenerife/family/20250419_202310.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Tenerife/family/20250420_105237.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Tenerife/family/20250420_132901.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Tenerife/family/20250420_145422.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Tenerife/family/20250420_185822.jpg')"></div>
        </div>

        <div class="relative z-10 h-full flex items-center px-8 md:px-24 safe-zone">
            <div class="max-w-4xl">
                <div class="flex items-baseline gap-6 mb-4 reveal-text">
                    <span class="chapter-number text-6xl md:text-8xl text-white">02</span>
                    <span class="movie-subtitle text-teal-300">Tenerife</span>
                </div>
                <h2 class="movie-title text-6xl md:text-8xl text-white mb-8 leading-none smooth-text" style="opacity: 0 !important; visibility: hidden !important; color: transparent !important;">Tenerife, Spain</h2>
                
                <div class="grid grid-cols-4 gap-8 mt-12 reveal-content">
                    <div class="text-center">
                        <p class="text-3xl font-bold text-white airport-text" data-text="Apr 18-26">APR 18-26</p>
                        <p class="text-[10px] uppercase tracking-widest text-gray-400">2025</p>
                    </div>
                    <div class="text-center">
                        <p class="text-3xl font-bold text-white airport-text" data-text="9">0</p>
                        <p class="text-[10px] uppercase tracking-widest text-gray-400">Days</p>
                    </div>
                    <div class="text-center">
                        <p class="text-3xl font-bold text-white airport-text" data-text="3718m">0m</p>
                        <p class="text-[10px] uppercase tracking-widest text-gray-400">Teide Peak</p>
                    </div>
                    <div class="text-center">
                        <p class="text-3xl font-bold text-white airport-text" data-text="22°">0°</p>
                        <p class="text-[10px] uppercase tracking-widest text-gray-400">Spring Sun</p>
                    </div>
                </div>

                <div class="mt-12 reveal-content">
                    <button onclick="openDiscoverModal('tenerife')" class="discover-btn">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path>
                        </svg>
                        Discover Tenerife
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Slide 4: Switzerland -->
    <div class="slide" data-index="3" data-date="August 22-29, 2025">
        <div class="absolute inset-0 overflow-hidden">
            <img src="images/Switzerland/main/20250824_093817.jpg" class="w-full h-full object-cover ken-burns origin-top">
            <div class="absolute inset-0 bg-black/30"></div>
        </div>

        <!-- Gallery Stack -->
        <div class="gallery-stack">
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Switzerland/landscape/1000103053.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Switzerland/landscape/20250822_184427.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Switzerland/landscape/20250822_185907.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Switzerland/landscape/20250822_185921.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Switzerland/landscape/20250822_190425.jpg')"></div>
        </div>

        <!-- Family Gallery Stack -->
        <div class="gallery-stack-family">
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Switzerland/family/20250822_183720.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Switzerland/family/20250822_191056.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Switzerland/family/20250822_201443.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Switzerland/family/20250824_094319.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/Switzerland/family/20250824_104213.jpg')"></div>
        </div>

        <div class="relative z-10 h-full flex flex-col justify-center items-center text-center safe-zone">
            <div class="reveal-text">
                <span class="movie-subtitle text-green-300 bg-black/50 px-4 py-1 backdrop-blur-md">Switzerland</span>
            </div>
            <h2 class="text-[10vw] font-black text-white leading-none tracking-tighter smooth-text" style="opacity: 0 !important; visibility: hidden !important; color: transparent !important;">SWITZERLAND</h2>
            <p class="movie-title text-3xl md:text-5xl text-white -mt-4 md:-mt-8 reveal-content">Zurich • Jungfraujoch</p>
            
            <div class="grid grid-cols-4 gap-12 mt-20 reveal-content">
                <div class="text-center">
                    <p class="text-4xl font-bold text-white airport-text" data-text="Aug 22-29">AUG 22-29</p>
                    <p class="text-[10px] uppercase tracking-widest text-gray-300 mt-2">2025</p>
                </div>
                <div class="text-center">
                    <p class="text-4xl font-bold text-white airport-text" data-text="8">0</p>
                    <p class="text-[10px] uppercase tracking-widest text-gray-300 mt-2">Days</p>
                </div>
                <div class="text-center">
                    <p class="text-4xl font-bold text-white airport-text" data-text="3,454m">0m</p>
                    <p class="text-[10px] uppercase tracking-widest text-gray-300 mt-2">Top of Europe</p>
                </div>
                <div class="text-center">
                    <p class="text-4xl font-bold text-white airport-text" data-text="∞">0</p>
                    <p class="text-[10px] uppercase tracking-widest text-gray-300 mt-2">Endless Chocolate</p>
                </div>
            </div>

            <div class="mt-12 reveal-content">
                <button onclick="openDiscoverModal('switzerland')" class="discover-btn">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path>
                    </svg>
                    Discover Switzerland
                </button>
            </div>
        </div>
    </div>

    <!-- Slide 5: Switzerland + Germany -->
    <div class="slide" data-index="4" data-date="October 23-30, 2025">
        <div class="absolute inset-0 overflow-hidden">
            <img src="images/SwitzerlandGermany/main/20251026_131424.jpg" class="w-full h-full object-cover ken-burns origin-right">
            <div class="gradient-overlay-bottom"></div>
        </div>

        <!-- Gallery Stack -->
        <div class="gallery-stack">
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/SwitzerlandGermany/landscape/1000105950.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/SwitzerlandGermany/landscape/20251023_155831.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/SwitzerlandGermany/landscape/20251025_110422.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/SwitzerlandGermany/landscape/20251025_123654.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/SwitzerlandGermany/landscape/20251026_083616.jpg')"></div>
        </div>

        <!-- Family Gallery Stack -->
        <div class="gallery-stack-family">
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/SwitzerlandGermany/family/20251023_153725.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/SwitzerlandGermany/family/20251023_170424.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/SwitzerlandGermany/family/20251027_153950.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/SwitzerlandGermany/family/20251028_101902.jpg')"></div>
            <div class="gallery-card" onclick="toggleExpand(this)" style="background-image: url('images/SwitzerlandGermany/family/20251028_110147.jpg')"></div>
        </div>

        <div class="relative z-10 h-full flex flex-col justify-end px-8 md:px-24 items-end text-right safe-zone">
            <div class="max-w-4xl">
                <div class="flex items-baseline justify-end gap-6 mb-4 reveal-text">
                    <span class="movie-subtitle text-amber-300">Switzerland & Germany</span>
                    <span class="chapter-number text-6xl md:text-8xl text-white">04</span>
                </div>
                <h2 class="movie-title text-6xl md:text-8xl text-white mb-8 leading-none smooth-text" style="opacity: 0 !important; visibility: hidden !important; color: transparent !important;">Switzerland<br>& Germany</h2>
                
                <div class="grid grid-cols-4 gap-8 mt-8 reveal-content justify-items-end">
                    <div class="text-right">
                        <p class="text-3xl font-bold text-white airport-text" data-text="Oct 23-30">OCT 23-30</p>
                        <p class="text-[10px] uppercase tracking-widest text-gray-400">2025</p>
                    </div>
                    <div class="text-right">
                        <p class="text-3xl font-bold text-white airport-text" data-text="8">0</p>
                        <p class="text-[10px] uppercase tracking-widest text-gray-400">Days</p>
                    </div>
                    <div class="text-right">
                        <p class="text-3xl font-bold text-white airport-text" data-text="4">0</p>
                        <p class="text-[10px] uppercase tracking-widest text-gray-400">Cities</p>
                    </div>
                    <div class="text-right">
                        <p class="text-3xl font-bold text-white airport-text" data-text="1">0</p>
                        <p class="text-[10px] uppercase tracking-widest text-gray-400">Castle</p>
                    </div>
                </div>

                <div class="flex justify-end gap-4 mt-8 reveal-content">
                     <span class="px-4 py-1 border border-white/30 rounded-full text-xs uppercase tracking-widest">Salzburg</span>
                     <span class="px-4 py-1 border border-white/30 rounded-full text-xs uppercase tracking-widest">Zurich</span>
                     <span class="px-4 py-1 border border-white/30 rounded-full text-xs uppercase tracking-widest">Munich</span>
                     <span class="px-4 py-1 border border-white/30 rounded-full text-xs uppercase tracking-widest">Neuschwanstein</span>
                </div>

                <div class="mt-12 flex justify-end reveal-content">
                    <button onclick="openDiscoverModal('germany')" class="discover-btn">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path>
                        </svg>
                        Discover Germany
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Slide 6: Summary (Credits) -->
    <div class="slide" data-index="5" data-date="December 31, 2025">
        <div class="absolute inset-0 bg-black overflow-hidden">
            <div class="absolute inset-0 opacity-30" style="background-image: url('data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'none\' fill-rule=\'evenodd\'%3E%3Cg fill=\'%23333\' fill-opacity=\'1\'%3E%3Cpath d=\'M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zM36 0V4h-4v2h-4V4h-2v4h-4V4H6v4H4V0h4zm0 60v-4h-4v-2h-4v2h-2v4h-4v2h4v4h2v-4h4v-2h-4zM6 56v-4H4v4H0v2h4v4h2v-4h4v-2H6z\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>

            <!-- Production collage: small, subtle tiles behind the text -->
            <div id="production-collage" aria-hidden="true"></div>
            <div id="christmas-snow-container" class="absolute inset-0 pointer-events-none"></div>
        </div>
        <div class="relative z-10 h-full flex flex-col justify-center items-center px-4 text-center">
            <h2 class="movie-title text-7xl md:text-9xl text-white mb-8 smooth-text" style="opacity: 0 !important; visibility: hidden !important; color: transparent !important;">Boldog Karácsonyt!</h2>
            <p class="text-gray-400 max-w-md mx-auto mb-12 reveal-content font-light italic">
                - Matyi :)
            </p>
            
            <button onclick="restartJourney()" class="px-8 py-3 border border-white/20 rounded-full hover:bg-white hover:text-black transition uppercase tracking-widest text-xs reveal-content mr-4">
                Watch Again
            </button>
        </div>
    </div>

    <!-- World Map Modal -->
    <div id="world-map-modal" class="discover-modal">
        <button onclick="closeWorldMap()" class="fixed top-12 right-12 z-[15001] w-16 h-16 flex items-center justify-center rounded-full bg-black/40 backdrop-blur-md border border-white/10 text-white/60 hover:text-white hover:bg-white/10 hover:border-white/30 transition-all duration-500 hover:scale-110 hover:rotate-90 group">
            <svg class="w-8 h-8 transition-transform duration-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
        <div class="discover-content" id="world-map-content">
            <div class="discover-hero animate-slide-in">
                <div class="discover-hero-content text-center" style="background: transparent;">
                    <span class="discover-subtitle">2025 Journey</span>
                    <h1 class="discover-title text-depth">All Our Adventures</h1>
                    <p class="discover-description max-w-2xl mx-auto">Four incredible trips across three continents. 36 days of exploration, countless memories.</p>
                </div>
            </div>
            
            <div style="max-width: 1200px; margin: 0 auto 4rem;">
                <div style="width: 100%; height: 600px; background: #0a0a0a; border-radius: 16px; overflow: hidden; position: relative; border: 1px solid rgba(255,255,255,0.1);">
                    <div id="world-map" style="width: 100%; height: 100%;"></div>
                </div>
            </div>
            
            <div class="text-center py-16">
                <button onclick="closeWorldMap()" class="discover-btn">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    <span>Return to Journey</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Discover Modals -->
    <div id="discover-modal" class="discover-modal">
        <button onclick="closeDiscoverModal()" class="fixed top-12 right-12 z-[15001] w-16 h-16 flex items-center justify-center rounded-full bg-black/40 backdrop-blur-md border border-white/10 text-white/60 hover:text-white hover:bg-white/10 hover:border-white/30 transition-all duration-500 hover:scale-110 hover:rotate-90 group">
            <svg class="w-8 h-8 transition-transform duration-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
        <div class="discover-content" id="discover-modal-content">
            <!-- Content will be dynamically loaded -->
        </div>
    </div>

    <script>
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        const totalSlides = slides.length;
    let isTransitioning = false;
    let isPreparingTransition = false;

        function restoreNavControls() {
            try {
                const navControls = document.getElementById('nav-controls');
                const btnPrevEl = document.getElementById('btn-prev');
                const btnNextEl = document.getElementById('btn-next');
                if (navControls) navControls.style.pointerEvents = '';
                if (btnPrevEl) { btnPrevEl.disabled = (currentSlide === 0); btnPrevEl.style.opacity = (currentSlide === 0 ? '0.3' : '1'); btnPrevEl.style.cursor = (currentSlide === 0 ? 'not-allowed' : 'pointer'); }
                if (btnNextEl) { btnNextEl.disabled = (currentSlide === (totalSlides - 1)); btnNextEl.style.opacity = (currentSlide === (totalSlides - 1) ? '0.3' : '1'); btnNextEl.style.cursor = (currentSlide === (totalSlides - 1) ? 'not-allowed' : 'pointer'); }
            } catch (e) { /* ignore */ }
        }
        const progressBar = document.getElementById('progress');
        const btnPrev = document.getElementById('btn-prev');
        const btnNext = document.getElementById('btn-next');

        // Parallax Effect for Backgrounds
        document.addEventListener('mousemove', (e) => {
            const x = (window.innerWidth - e.pageX * 2) / 100;
            const y = (window.innerHeight - e.pageY * 2) / 100;
            
            const activeSlideImg = document.querySelector('.slide.active img');
            if(activeSlideImg) {
                activeSlideImg.style.transform = `scale(1.15) translate(${x}px, ${y}px)`;
            }
        });

        // 3D Tilt Effect for Cards
        document.addEventListener('mousemove', (e) => {
            const cards = document.querySelectorAll('.slide.active .tilt-element');
            cards.forEach(card => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;
                
                const rotateX = ((y - centerY) / centerY) * -5; // Max rotation deg
                const rotateY = ((x - centerX) / centerX) * 5;

                card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
            });
        });

        // Snow Effect
        function createSnow(containerId, count = 50) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            // Clear existing snow
            container.innerHTML = '';
            
            for(let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                const size = Math.random() * 4 + 2;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.animation = `snowfall ${Math.random() * 3 + 2}s linear infinite`;
                particle.style.animationDelay = `${Math.random() * 5}s`;
                container.appendChild(particle);
            }
        }
        
        // Initialize global snow
        createSnow('snow-container', 30);

        function updateProgress() {
            const progress = ((currentSlide) / (totalSlides - 1)) * 100;
            progressBar.style.width = `${progress}%`;
            
            btnPrev.disabled = currentSlide === 0;
            btnPrev.style.opacity = currentSlide === 0 ? '0.3' : '1';
            btnPrev.style.cursor = currentSlide === 0 ? 'not-allowed' : 'pointer';
            
            if (currentSlide === totalSlides - 1) {
                btnNext.innerHTML = '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>';
                btnNext.onclick = () => location.reload();
            } else {
                btnNext.innerHTML = '<svg class="w-6 h-6 group-hover:translate-x-1 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>';
                btnNext.onclick = nextSlide;
            }
        }

        // Check Session Storage for Access
        window.addEventListener('load', () => {
            if (sessionStorage.getItem('accessGranted') === 'true') {
                const gate = document.getElementById('access-gate');
                gate.style.display = 'none';
            }
        });

        // Access Gate Logic
        function checkAccess(input) {
            const code = input.value;
            const errorMsg = document.getElementById('access-error');
            const gate = document.getElementById('access-gate');
            
            if (code.length === 4) {
                if (code === '2025') {
                    // Success
                    sessionStorage.setItem('accessGranted', 'true'); // Save session
                    input.blur();
                    input.classList.add('text-green-400', 'border-green-400');
                    errorMsg.style.opacity = '0';
                    
                    // Cinematic Unlock
                    setTimeout(() => {
                        gate.style.opacity = '0';
                        gate.style.pointerEvents = 'none';
                        
                        // Start background audio if possible (might be blocked by browser policy without click)
                        // But we can try or wait for the "Begin Film" button
                    }, 800);
                } else {
                    // Error
                    input.classList.add('text-red-500', 'border-red-500');
                    errorMsg.style.opacity = '1';
                    
                    // Shake effect
                    input.style.transform = 'translateX(10px)';
                    setTimeout(() => input.style.transform = 'translateX(-10px)', 100);
                    setTimeout(() => input.style.transform = 'translateX(10px)', 200);
                    setTimeout(() => input.style.transform = 'translateX(0)', 300);
                    
                    // Reset
                    setTimeout(() => {
                        input.value = '';
                        input.classList.remove('text-red-500', 'border-red-500');
                        errorMsg.style.opacity = '0';
                    }, 1000);
                }
            }
        }

        // Restart Journey
        function restartJourney() {
            // Reset all slide states
            slides.forEach((s, i) => {
                s.classList.remove('active', 'prev', 'entering', 'exiting-left', 'exiting-right', 'disappearing', 'content-disappear');
                if (i === 0) {
                    s.classList.add('active');
                }
            });
            
            currentSlide = 0;
            isTransitioning = false;
            isPreparingTransition = false;
            
            // Update progress
            updateProgress();
            
            // Show Intro Overlay
            const overlay = document.getElementById('intro-overlay');
            if (overlay) {
                overlay.classList.remove('hidden');
                overlay.style.opacity = '1'; 
                overlay.style.visibility = 'visible';
            }
            
            // Hide controls
            const nav = document.getElementById('nav-controls');
            if(nav) nav.classList.add('opacity-0', 'pointer-events-none');
            
            // Reset Audio
            const audio = document.getElementById('cinematic-audio');
            if (audio) {
                audio.pause();
                audio.currentTime = 0;
            }
            
            // Reset Cinema Mode
            document.body.classList.remove('cinema-mode');
            
            // Stage the first slide to prepare for replay
            stageSlide(0);
        }

        // Airport Text Animation
        function animateAirportText(element) {
            const target = element.getAttribute('data-text');
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let iterations = 0;
            
            // Clear previous interval if any
            if (element.dataset.interval) clearInterval(element.dataset.interval);
            
            const interval = setInterval(() => {
                element.innerText = target.split('').map((letter, index) => {
                    if(index < iterations) return target[index];
                    return chars[Math.floor(Math.random() * chars.length)];
                }).join('');
                
                if(iterations >= target.length) {
                    clearInterval(interval);
                    element.innerText = target; // Ensure final value is correct
                }
                
                iterations += 1 / 6; // Much slower resolution
            }, 40);
            
            element.dataset.interval = interval;
        }

        // Smooth Text Animation - FLASH FIX
        function animateSmoothText(element) {
            if (!element) return;
            
            // Remove conflicting classes if present to ensure visibility
            element.classList.remove('textured-text');
            
            // Remove inline styles from HTML that were used to force initial hide
            element.style.removeProperty('opacity');
            element.style.removeProperty('visibility');
            element.style.removeProperty('color');
            
            // Initialize split text if not done
            if (!element.classList.contains('split-done')) {
                const text = element.textContent.trim();
                element.innerHTML = ''; 
                
                [...text].forEach(char => {
                    const span = document.createElement('span');
                    if (char === ' ') {
                        span.className = 'space';
                        span.innerHTML = '&nbsp;';
                    } else {
                        span.textContent = char;
                    }
                    element.appendChild(span);
                });
                element.classList.add('split-done');
            }
            
            const spans = element.querySelectorAll('span');
            
            // 1. FORCE hide immediately (disable transition)
            spans.forEach(span => {
                span.style.transition = 'none';
                span.style.opacity = '0';
                span.style.transform = 'translateY(100px) scale(0.8)';
                span.style.filter = 'blur(50px) brightness(0)';
                span.classList.remove('visible');
            });
            
            // 2. Force multiple reflows to ensure styles are applied
            void element.offsetWidth;
            void element.offsetHeight;
            requestAnimationFrame(() => {
                void element.offsetWidth;
            });
            
            // 3. Enable transition and animate after a delay
            setTimeout(() => {
                spans.forEach(span => {
                    span.style.transition = ''; // Restore CSS transition
                });
                
                // Wait one more frame before revealing
                requestAnimationFrame(() => {
                    spans.forEach((span, index) => {
                        setTimeout(() => {
                            span.classList.add('visible');
                        }, index * 40); // Slightly faster, cinematic
                    });
                });
            }, 150); // Longer delay to ensure complete reset
        }

        // Stage Slide - Hide ALL content before transition
        function stageSlide(index) {
            const slide = slides[index];
            if (!slide) return;
            
            // FORCE Hide smooth texts (titles) completely
            const smoothTexts = slide.querySelectorAll('.smooth-text');
            smoothTexts.forEach(text => {
                text.classList.remove('staged-visible');
                text.style.opacity = '0';
                text.style.visibility = 'hidden';
                text.style.color = 'transparent';
                
                const spans = text.querySelectorAll('span');
                spans.forEach(span => {
                    span.classList.remove('visible');
                    span.style.transition = 'none';
                    span.style.opacity = '0';
                    span.style.transform = 'translateY(100px) scale(0.8)';
                    span.style.filter = 'blur(50px) brightness(0)';
                });
            });
            
            // Hide all reveal-text elements
            const revealTexts = slide.querySelectorAll('.reveal-text');
            revealTexts.forEach(el => el.classList.remove('visible'));
            
            // Hide all reveal-content elements
            const revealContents = slide.querySelectorAll('.reveal-content');
            revealContents.forEach(el => el.classList.remove('visible'));
        }

        // Cinematic Sequence: Background → Title → Content + Galleries
        function triggerSlideAnimations(index) {
            const activeSlide = slides[index];
            
            // Ensure all content starts completely hidden
            const smoothTexts = activeSlide.querySelectorAll('.smooth-text');
            smoothTexts.forEach(text => {
                text.classList.remove('staged-visible');
                const spans = text.querySelectorAll('span');
                spans.forEach(span => {
                    span.classList.remove('visible');
                    span.style.transition = 'none';
                });
            });
            
            // PHASE 1: Background visible (1.2 seconds of just background)
            setTimeout(() => {
                // PHASE 2: Animate Title
                smoothTexts.forEach((text, i) => {
                    setTimeout(() => {
                        // Start character animation (splits and hides spans first)
                        animateSmoothText(text);
                        
                        // Make container visible immediately after spans are hidden
                        // Use requestAnimationFrame to ensure the hide logic in animateSmoothText applies first
                        requestAnimationFrame(() => {
                            text.classList.add('staged-visible');
                        });
                    }, i * 400);
                });
            }, 400); // Longer initial delay for background only
            
            // PHASE 3: Reveal rest of content (after title animation completes)
            setTimeout(() => {
                // Reveal subtitle/chapter text
                const revealTexts = activeSlide.querySelectorAll('.reveal-text');
                revealTexts.forEach((el, i) => {
                    setTimeout(() => {
                        el.classList.add('visible');
                    }, i * 200);
                });
                
                // Reveal stats/content
                const revealContents = activeSlide.querySelectorAll('.reveal-content');
                revealContents.forEach((el, i) => {
                    setTimeout(() => {
                        el.classList.add('visible');
                    }, i * 150 + 400);
                });
                
                // Airport Text Animation
                const counters = activeSlide.querySelectorAll('.airport-text');
                counters.forEach((counter, i) => {
                    counter.innerText = '0';
                    setTimeout(() => animateAirportText(counter), i * 100 + 600);
                });
                
                // REVEAL GALLERY STACKS with content
                setTimeout(() => {
                    const galleryStacks = activeSlide.querySelectorAll('.gallery-stack, .gallery-stack-family');
                    galleryStacks.forEach((stack, i) => {
                        setTimeout(() => {
                            stack.classList.add('visible');
                            restoreGalleryPosition(stack); // Restore saved position
                        }, i * 200);
                    });
                }, 800);
            }, 3200); // Wait longer for title to fully finish
        }

        function showSlide(index, direction = 'forward') {
            if (index === currentSlide) return;
            if (isTransitioning) return; // prevent overlapping transitions
            isTransitioning = true;
            // Hide all galleries when switching slides
            document.querySelectorAll('.gallery-stack, .gallery-stack-family').forEach(stack => {
                stack.classList.remove('visible');
            });

            // Stage the next slide before showing it (hide elements)
            stageSlide(index);

            const outgoing = slides[currentSlide];
            const incoming = slides[index];

            // Clear any previous animation classes
            slides.forEach(s => s.classList.remove('entering', 'exiting-left', 'exiting-right'));

            // Mark outgoing animation
            if (outgoing) {
                outgoing.classList.remove('active');
                outgoing.classList.add(direction === 'forward' ? 'exiting-left' : 'exiting-right');
            }

            // Prepare incoming
            incoming.classList.remove('prev');
            incoming.classList.add('entering');
            // Ensure incoming is visible so animation can play
            incoming.classList.add('active');

            // cinematic flare
            const flare = document.getElementById('cinematic-flare');
            if (flare) {
                flare.classList.add('active');
                setTimeout(() => flare.classList.remove('active'), 700);
            }

            // Slight parallax/zoom on background image of incoming
            const incomingImg = incoming.querySelector('img');
            if (incomingImg) incomingImg.style.transform = 'scale(1.12)';

            // After animation, finalize state
            const animDuration = 920; // should match CSS transitions
            setTimeout(() => {
                // cleanup entering/exiting
                incoming.classList.remove('entering');
                if (outgoing) outgoing.classList.remove('exiting-left', 'exiting-right');

                // reset incoming background transform to allow ken-burns
                if (incomingImg) incomingImg.style.transform = '';

                // Update prev flags
                slides.forEach((slide, i) => {
                    slide.classList.remove('prev');
                    if (i < index) slide.classList.add('prev');
                });

                // set current slide and update progress
                currentSlide = index;
                updateProgress();

                // Ensure nav controls are restored after the transition
                restoreNavControls();

                // Small delay to allow new slide to settle, then trigger content animations
                setTimeout(() => triggerSlideAnimations(index), 120);

                // Trigger heavy snow only on Christmas slide (Index 6)
                if (index === 6) createSnow('christmas-snow-container', 100);
                // Cleanup: ensure any content-disappear classes are removed now that transition finished
                try { slides.forEach(s => s.classList.remove('content-disappear')); } catch (e) {}
                isTransitioning = false;
            }, animDuration);
        }

        function nextSlide() {
            if (currentSlide < totalSlides - 1) {
                disappearThenShow(currentSlide + 1, 'forward');
            }
        }

        function prevSlide() {
            if (currentSlide > 0) {
                disappearThenShow(currentSlide - 1, 'backward');
            }
        }

        // Play a disappearing animation on the current slide, then show the next
        function disappearThenShow(nextIndex, direction = 'forward') {
            if (isTransitioning || isPreparingTransition) return;
            isPreparingTransition = true;
            const outgoing = slides[currentSlide];
            if (!outgoing) { showSlide(nextIndex, direction); return; }

            // First: animate CONTENT disappearing (titles, stats, galleries)
            outgoing.classList.add('content-disappear');

            // Do NOT immediately strip classes; let CSS animate the children out smoothly.
            // Disable nav buttons while content disappears to prevent early interaction
            try {
                const btnPrevEl = document.getElementById('btn-prev');
                const btnNextEl = document.getElementById('btn-next');
                if (btnPrevEl) { btnPrevEl.disabled = true; btnPrevEl.style.opacity = '0.3'; }
                if (btnNextEl) { btnNextEl.disabled = true; btnNextEl.style.opacity = '0.3'; }
                const navControls = document.getElementById('nav-controls');
                if (navControls) navControls.style.pointerEvents = 'none';
            } catch (e) {}
            // Wait for content disappearance to finish, then short delay, then run slide transition
            const contentDisappearDuration = 800; // content animation (ms)
            const gapAfterContent = 100; // short pause before slide transition

            setTimeout(() => {
                // A small gap to breathe
                setTimeout(() => {
                    isPreparingTransition = false;
                    // Restore nav pointer-events now (showSlide will disable/enable appropriately)
                    try { if (document.getElementById('nav-controls')) document.getElementById('nav-controls').style.pointerEvents = ''; } catch (e) {}
                    try {
                        showSlide(nextIndex, direction);
                    } catch (err) {
                        restoreNavControls();
                        console.error('showSlide failed', err);
                    }
                }, gapAfterContent);
            }, contentDisappearDuration);
        }

        // Navigation via keyboard arrows/space is intentionally disabled — navigation is button-only
        // (Lightbox-specific keyboard handlers remain active elsewhere.)

        // Scrolling-based navigation disabled — site navigates only via on-screen buttons

        // Touch swipe navigation disabled — use buttons to change slides

        // Dust Effect
        function createDust() {
            /*
            const container = document.getElementById('dust-container');
            const particleCount = 40;
            
            for(let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'dust-mote';
                const size = Math.random() * 3 + 1;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.animation = `floatDust ${Math.random() * 10 + 10}s linear infinite`;
                particle.style.animationDelay = `-${Math.random() * 20}s`;
                particle.style.opacity = Math.random() * 0.5 + 0.1;
                container.appendChild(particle);
            }
            */
        }
        createDust();

        // Populate the production collage with subtle small tiles taken from gallery images
        function populateProductionCollage() {
            const collage = document.getElementById('production-collage');
            if (!collage) {
                console.warn('production-collage element not found');
                return;
            }

            // Choose tile size based on viewport so tiles are larger across devices
            const tileSize = window.innerWidth < 640 ? 48 : (window.innerWidth < 1024 ? 56 : 64);
            collage.style.setProperty('--tile-size', tileSize + 'px');

            // Gather image URLs from existing gallery cards on the page
            const cards = Array.from(document.querySelectorAll('.gallery-card'));
            const srcs = cards.map(c => {
                const inline = c.getAttribute('style') || '';
                const computed = getComputedStyle(c).backgroundImage || '';
                const bg = inline || computed;
                const m = bg.match(/url\((?:"|')?(.*?)(?:"|')?\)/);
                return m ? m[1] : null;
            }).filter(Boolean);

            // Build a comprehensive list of all your images from all locations
            const yourImages = [
                // Thailand
                'images/Thailand/landscape/20250206_184205.jpg',
                'images/Thailand/landscape/20250207_094342.jpg',
                'images/Thailand/landscape/20250207_094818.jpg',
                'images/Thailand/landscape/20250207_100425.jpg',
                'images/Thailand/landscape/20250207_101906.jpg',
                'images/Thailand/landscape/20250207_105733.jpg',
                'images/Thailand/landscape/20250207_121750.jpg',
                'images/Thailand/landscape/20250208_104229.jpg',
                'images/Thailand/landscape/20250208_153309.jpg',
                'images/Thailand/landscape/20250209_102715.jpg',
                'images/Thailand/family/20250207_160623.jpg',
                'images/Thailand/family/20250207_194259.jpg',
                'images/Thailand/family/20250208_112510.jpg',
                'images/Thailand/family/20250209_104409.jpg',
                'images/Thailand/family/20250209_160456.jpg',
                // Tenerife
                'images/Tenerife/landscape/1000091123.jpg',
                'images/Tenerife/landscape/1000091445.jpg',
                'images/Tenerife/landscape/20250419_202034.jpg',
                'images/Tenerife/landscape/20250420_145047.jpg',
                'images/Tenerife/landscape/20250420_150357.jpg',
                'images/Tenerife/landscape/20250420_172253.jpg',
                'images/Tenerife/landscape/20250420_185551.jpg',
                'images/Tenerife/landscape/20250421_133945.jpg',
                'images/Tenerife/family/20250419_202310.jpg',
                'images/Tenerife/family/20250420_105237.jpg',
                'images/Tenerife/family/20250420_132901.jpg',
                'images/Tenerife/family/20250420_145422.jpg',
                'images/Tenerife/family/20250420_185822.jpg',
                // Switzerland
                'images/Switzerland/landscape/1000103053.jpg',
                'images/Switzerland/landscape/20250822_184427.jpg',
                'images/Switzerland/landscape/20250822_185907.jpg',
                'images/Switzerland/landscape/20250822_185921.jpg',
                'images/Switzerland/landscape/20250822_190425.jpg',
                'images/Switzerland/landscape/20250822_190531.jpg',
                'images/Switzerland/landscape/20250823_110251.jpg',
                'images/Switzerland/landscape/20250823_110902.jpg',
                'images/Switzerland/landscape/20250823_124725.jpg',
                'images/Switzerland/family/20250822_183720.jpg',
                'images/Switzerland/family/20250822_191056.jpg',
                'images/Switzerland/family/20250822_201443.jpg',
                'images/Switzerland/family/20250824_094319.jpg',
                'images/Switzerland/family/20250824_104213.jpg',
                // Switzerland & Germany
                'images/SwitzerlandGermany/landscape/1000105950.jpg',
                'images/SwitzerlandGermany/landscape/20251023_155831.jpg',
                'images/SwitzerlandGermany/landscape/20251025_110422.jpg',
                'images/SwitzerlandGermany/landscape/20251025_123654.jpg',
                'images/SwitzerlandGermany/landscape/20251026_083616.jpg',
                'images/SwitzerlandGermany/landscape/20251026_112607.jpg',
                'images/SwitzerlandGermany/landscape/20251026_120533.jpg',
                'images/SwitzerlandGermany/landscape/20251026_131424.jpg',
                'images/SwitzerlandGermany/family/20251023_153725.jpg',
                'images/SwitzerlandGermany/family/20251023_170424.jpg',
                'images/SwitzerlandGermany/family/20251027_153950.jpg',
                'images/SwitzerlandGermany/family/20251028_101902.jpg',
                'images/SwitzerlandGermany/family/20251028_110147.jpg'
            ];

            // Use gallery images from the page if available, otherwise use your image list
            const pool = srcs.length ? srcs : yourImages;

            const cols = Math.ceil(window.innerWidth / (tileSize + 1));
            const rows = Math.ceil(window.innerHeight / (tileSize + 1));
            const count = Math.max(200, cols * rows * 1.2); // Ensure full coverage

            // Build a scrolling track containing two identical sequences for seamless looping
            collage.innerHTML = '';
            
            // Create wrapper for seamless loop
            const wrapper = document.createElement('div');
            wrapper.className = 'collage-wrapper';
            
            // Create first grid
            const gridA = document.createElement('div');
            gridA.className = 'collage-grid';
            
            // Create tiles in first grid
            for (let i = 0; i < count; i++) {
                const url = pool[Math.floor(Math.random() * pool.length)];
                const tile = document.createElement('div');
                tile.className = 'prod-tile';
                tile.style.backgroundImage = `url('${url}')`;
                tile.style.opacity = (0.65 + Math.random() * 0.35).toFixed(2);
                gridA.appendChild(tile);
            }

            // Create second grid (identical copy for seamless loop)
            const gridB = document.createElement('div');
            gridB.className = 'collage-grid';
            gridB.innerHTML = gridA.innerHTML;

            // Assemble wrapper and add to collage
            wrapper.appendChild(gridA);
            wrapper.appendChild(gridB);
            collage.appendChild(wrapper);

            console.log(`Production collage populated with ${count} tiles × 2 grids (endless scroll) using your photos`);
        }

        // Populate mobile collage with same logic
        function populateMobileCollage() {
            const collage = document.getElementById('mobile-collage');
            if (!collage) {
                return; // Not on mobile, skip
            }

            // Choose tile size based on viewport
            const tileSize = window.innerWidth < 640 ? 48 : 64;
            collage.style.setProperty('--tile-size', tileSize + 'px');

            // Use your actual images instead of fallback
            const yourImages = [
                // Thailand
                'images/Thailand/landscape/20250206_184205.jpg',
                'images/Thailand/landscape/20250207_094342.jpg',
                'images/Thailand/landscape/20250207_094818.jpg',
                'images/Thailand/landscape/20250207_100425.jpg',
                'images/Thailand/landscape/20250207_101906.jpg',
                'images/Thailand/family/20250207_160623.jpg',
                'images/Thailand/family/20250207_194259.jpg',
                // Tenerife
                'images/Tenerife/landscape/1000091123.jpg',
                'images/Tenerife/landscape/1000091445.jpg',
                'images/Tenerife/landscape/20250419_202034.jpg',
                'images/Tenerife/family/20250419_202310.jpg',
                'images/Tenerife/family/20250420_105237.jpg',
                // Switzerland
                'images/Switzerland/landscape/1000103053.jpg',
                'images/Switzerland/landscape/20250822_184427.jpg',
                'images/Switzerland/landscape/20250822_185907.jpg',
                'images/Switzerland/family/20250822_183720.jpg',
                'images/Switzerland/family/20250822_191056.jpg',
                // Switzerland & Germany
                'images/SwitzerlandGermany/landscape/1000105950.jpg',
                'images/SwitzerlandGermany/landscape/20251023_155831.jpg',
                'images/SwitzerlandGermany/landscape/20251025_110422.jpg',
                'images/SwitzerlandGermany/family/20251023_153725.jpg',
                'images/SwitzerlandGermany/family/20251023_170424.jpg'
            ];

            const cols = Math.ceil(window.innerWidth / (tileSize + 1));
            const rows = Math.ceil(window.innerHeight / (tileSize + 1));
            const count = Math.max(150, cols * rows * 1.2);

            collage.innerHTML = '';
            
            const wrapper = document.createElement('div');
            wrapper.className = 'collage-wrapper';
            
            const gridA = document.createElement('div');
            gridA.className = 'collage-grid';
            
            for (let i = 0; i < count; i++) {
                const url = yourImages[Math.floor(Math.random() * yourImages.length)];
                const tile = document.createElement('div');
                tile.className = 'prod-tile';
                tile.style.backgroundImage = `url('${url}')`;
                tile.style.opacity = (0.65 + Math.random() * 0.35).toFixed(2);
                gridA.appendChild(tile);
            }

            const gridB = document.createElement('div');
            gridB.className = 'collage-grid';
            gridB.innerHTML = gridA.innerHTML;

            wrapper.appendChild(gridA);
            wrapper.appendChild(gridB);
            collage.appendChild(wrapper);

            console.log(`Mobile collage populated with ${count} tiles × 2 grids using your photos`);
        }

        // Mobile access code check
        function checkMobileAccess(input) {
            const code = input.value;
            const errorMsg = document.getElementById('mobile-access-error');
            const accessDiv = document.getElementById('mobile-access');
            const messageDiv = document.getElementById('mobile-message');
            const collageDiv = document.getElementById('mobile-collage');
            
            if (code.length === 4) {
                if (code === '2025') {
                    // Correct code - show message screen with rolling background
                    accessDiv.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                    accessDiv.style.opacity = '0';
                    accessDiv.style.transform = 'translateY(-20px)';
                    
                    setTimeout(() => {
                        accessDiv.classList.add('hidden');
                        messageDiv.classList.remove('hidden');
                        messageDiv.style.opacity = '0';
                        messageDiv.style.transform = 'translateY(20px)';
                        
                        // Fade in the rolling grid background
                        if (collageDiv) {
                            collageDiv.style.opacity = '0.4';
                        }
                        
                        requestAnimationFrame(() => {
                            messageDiv.style.transition = 'opacity 0.8s ease, transform 0.8s ease';
                            messageDiv.style.opacity = '1';
                            messageDiv.style.transform = 'translateY(0)';
                        });
                    }, 600);
                } else {
                    // Wrong code
                    errorMsg.style.opacity = '1';
                    input.value = '';
                    input.style.borderColor = 'rgba(239, 68, 68, 0.5)';
                    
                    setTimeout(() => {
                        errorMsg.style.opacity = '0';
                        input.style.borderColor = '';
                    }, 2000);
                }
            }
        }

        // Initialize collage and reflow on resize with debounce
        populateProductionCollage();
        populateMobileCollage();
        let __collageResizeTimer = null;
        window.addEventListener('resize', () => {
            clearTimeout(__collageResizeTimer);
            __collageResizeTimer = setTimeout(() => populateProductionCollage(), 220);
        });

        // Cinematic Start
        function startExperience() {
            const audio = document.getElementById('cinematic-audio');
            const overlay = document.getElementById('intro-overlay');
            const body = document.body;

            // Try to play audio
            audio.volume = 0.4;
            audio.play().catch(e => console.log("Audio play failed:", e));

            // Enable Cinema Mode (Letterboxing)
            body.classList.add('cinema-mode');

            // Fade out overlay
            overlay.classList.add('hidden');

            // Show controls
            const nav = document.getElementById('nav-controls');
            if(nav) nav.classList.remove('opacity-0', 'pointer-events-none');

            // Trigger first slide animations explicitly if needed
            setTimeout(() => {
                document.querySelector('.slide.active').style.opacity = '1';
                triggerSlideAnimations(0);
            }, 100);
        }

        updateProgress();

        // Mouse Tracking for Spotlight
        document.addEventListener('mousemove', (e) => {
            const x = (e.clientX / window.innerWidth) * 100;
            const y = (e.clientY / window.innerHeight) * 100;
            document.documentElement.style.setProperty('--mouse-x', `${x}%`);
            document.documentElement.style.setProperty('--mouse-y', `${y}%`);
        });

        // Magnetic Buttons
        const magneticBtns = document.querySelectorAll('.magnetic-btn');
        magneticBtns.forEach(btn => {
            btn.addEventListener('mousemove', (e) => {
                const rect = btn.getBoundingClientRect();
                const x = e.clientX - rect.left - rect.width / 2;
                const y = e.clientY - rect.top - rect.height / 2;
                
                // Magnetic pull strength
                const strength = 20;
                const xMove = (x / rect.width) * strength;
                const yMove = (y / rect.height) * strength;

                btn.style.transform = `translate(${xMove}px, ${yMove}px)`;
            });

            btn.addEventListener('mouseleave', () => {
                btn.style.transform = 'translate(0, 0)';
            });
        });

        // Gallery Lightbox Logic
            // Prevent double-opening when we programmatically open the lightbox on pointerup
            let ignoreNextInlineClick = false;

            // New gallery + lightbox flow: open a selector modal with thumbnails so it's easy
            // to pick the exact image. Clicking a thumbnail opens the lightbox with keyboard
            // nav and swipe support.
            let currentGallery = [];
            let currentGalleryIndex = 0;
            let lastClickedCard = null; // element used as source for shared-element animation
            let lastOpenedCard = null; // remembers which card the lightbox opened from

            function toggleExpand(card) {
                // If a long-press/drag just happened, don't open the lightbox
                if (suppressCardClick || isLongPressActive || hasMoved) return;
                if (ignoreNextInlineClick) { ignoreNextInlineClick = false; return; }

                // Find gallery stack and assemble image URLs
                const stack = card.closest('.gallery-stack') || card.closest('.gallery-stack-family');
                if (!stack) return;

                const cards = Array.from(stack.querySelectorAll('.gallery-card'));
                currentGallery = cards.map(c => {
                    const bg = c.style.backgroundImage || '';
                    const match = bg.match(/url\((?:\"|\')?(.*?)(?:\"|\')?\)/);
                    return match ? match[1] : '';
                }).filter(Boolean);

                // If the clicked card exists in the list, start at that index
                const clickedBg = (card.style.backgroundImage || '').match(/url\((?:\"|\')?(.*?)(?:\"|\')?\)/);
                const clickedUrl = clickedBg ? clickedBg[1] : '';
                currentGalleryIndex = Math.max(0, currentGallery.indexOf(clickedUrl));

                // Remember source card for shared-element animation
                lastClickedCard = card;
                // Open the lightbox directly for easier selection in the deck.
                // If you want the selector modal instead, hold Shift when clicking (not implemented as event here),
                // but the direct lightbox open makes picking and browsing immediate.
                openLightboxFromGallery(currentGalleryIndex, lastClickedCard);
            }

            function openGallerySelector(urls = [], startIndex = 0) {
                const sel = document.getElementById('gallery-selector');
                const thumbs = document.getElementById('selector-thumbs');
                const preview = document.getElementById('selector-preview');
                if (!sel || !thumbs || !preview) return;

                thumbs.innerHTML = '';
                urls.forEach((u, i) => {
                    const d = document.createElement('div');
                    d.className = 'thumb';
                    d.style.backgroundImage = `url('${u}')`;
                    d.setAttribute('role', 'button');
                    d.setAttribute('data-index', i);
                    d.addEventListener('click', (ev) => {
                        ev.stopPropagation();
                        setSelectorActive(i);
                    });
                    d.addEventListener('dblclick', (ev) => {
                        ev.stopPropagation();
                        openLightboxFromGallery(i);
                    });
                    thumbs.appendChild(d);
                });

                // show
                sel.classList.add('visible');
                sel.setAttribute('aria-hidden', 'false');

                // set start index and show preview
                setSelectorActive(startIndex || 0);

                // prevent underlying click handlers from opening lightbox
                ignoreNextInlineClick = true;
            }

            function setSelectorActive(index) {
                const preview = document.getElementById('selector-preview');
                const thumbs = document.querySelectorAll('#selector-thumbs .thumb');
                if (!preview) return;
                index = Math.max(0, Math.min(index, thumbs.length - 1));
                thumbs.forEach(t => t.classList.remove('active'));
                if (thumbs[index]) thumbs[index].classList.add('active');
                preview.src = currentGallery[index] || '';
                currentGalleryIndex = index;
                // Ensure active thumb is visible
                if (thumbs[index]) thumbs[index].scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
            }

            function closeGallerySelector() {
                const sel = document.getElementById('gallery-selector');
                if (!sel) return;
                sel.classList.remove('visible');
                sel.setAttribute('aria-hidden', 'true');
            }

            // Open lightbox from selector (double-confirm) or directly from thumb
            function openLightboxFromGallery(index, sourceElem) {
                index = Math.max(0, Math.min(index, currentGallery.length - 1));
                currentGalleryIndex = index;
                const overlay = document.getElementById('lightbox-overlay');
                const img = document.getElementById('lightbox-img');

                // If we have a source element (card), perform a shared-element expand animation
                try {
                    animateOpenLightbox(index, sourceElem);
                } catch (e) {
                    // Fallback to immediate open
                    img.src = currentGallery[index] || '';
                    overlay.classList.remove('opacity-0', 'pointer-events-none');
                    document.body.classList.add('lightbox-open');
                    setTimeout(() => { img.classList.remove('scale-90'); img.classList.add('scale-100'); }, 40);
                }
                closeGallerySelector();
            }

            // Shared-element open animation: clone image from source card and animate to center
            function animateOpenLightbox(index, sourceElem) {
                const overlay = document.getElementById('lightbox-overlay');
                const img = document.getElementById('lightbox-img');
                const src = currentGallery[index];
                if (!src) return;

                // Create clone
                const clone = document.createElement('img');
                clone.className = 'transition-clone';
                clone.src = src;
                clone.style.position = 'fixed';

                // determine start rect
                let startRect = null;
                if (sourceElem && sourceElem.getBoundingClientRect) startRect = sourceElem.getBoundingClientRect();
                if (!startRect) {
                    // fallback: center small
                    startRect = { left: window.innerWidth / 2 - 40, top: window.innerHeight / 2 - 30, width: 80, height: 60 };
                }

                clone.style.left = startRect.left + 'px';
                clone.style.top = startRect.top + 'px';
                clone.style.width = startRect.width + 'px';
                clone.style.height = startRect.height + 'px';
                if (sourceElem) {
                    try { clone.style.borderRadius = window.getComputedStyle(sourceElem).borderRadius || '8px'; } catch (e) { clone.style.borderRadius = '8px'; }
                } else {
                    clone.style.borderRadius = '8px';
                }

                document.body.appendChild(clone);

                // hide real lightbox image until animation completes
                img.style.visibility = 'hidden';

                // show overlay underneath the clone to dim background during animation
                overlay.classList.remove('opacity-0', 'pointer-events-none');
                document.body.classList.add('lightbox-open');

                // compute target size (fit within 90vw/90vh while preserving aspect)
                const maxW = window.innerWidth * 0.9;
                const maxH = window.innerHeight * 0.9;
                const tmp = new Image();
                tmp.onload = () => {
                    let targetW = tmp.naturalWidth;
                    let targetH = tmp.naturalHeight;
                    const ratio = targetW / targetH;
                    if (targetW > maxW) { targetW = maxW; targetH = targetW / ratio; }
                    if (targetH > maxH) { targetH = maxH; targetW = targetH * ratio; }

                    const targetLeft = Math.round((window.innerWidth - targetW) / 2);
                    const targetTop = Math.round((window.innerHeight - targetH) / 2);

                    // force repaint
                    clone.getBoundingClientRect();

                    // animate to target
                    clone.style.left = targetLeft + 'px';
                    clone.style.top = targetTop + 'px';
                    clone.style.width = targetW + 'px';
                    clone.style.height = targetH + 'px';
                    clone.style.borderRadius = '6px';

                    // after transition, reveal real img and remove clone
                    const cleanup = () => {
                        clone.removeEventListener('transitionend', cleanup);
                        try { document.body.removeChild(clone); } catch (e) {}
                        img.src = src;
                        img.style.visibility = '';
                        img.classList.remove('scale-90');
                        img.classList.add('scale-100');
                        lastOpenedCard = sourceElem || null;
                    };
                    clone.addEventListener('transitionend', cleanup);
                };
                tmp.onerror = () => {
                    // fallback: show immediately
                    try { clone.remove(); } catch (e) {}
                    document.body.classList.add('lightbox-open');
                    overlay.classList.remove('opacity-0', 'pointer-events-none');
                    img.src = src;
                    img.style.visibility = '';
                    img.classList.remove('scale-90');
                    img.classList.add('scale-100');
                    lastOpenedCard = sourceElem || null;
                };
                tmp.src = src;
            }

            function nextLightbox() {
                if (!currentGallery || currentGallery.length === 0) return;
                currentGalleryIndex = (currentGalleryIndex + 1) % currentGallery.length;
                const img = document.getElementById('lightbox-img');
                img.classList.add('scale-90');
                setTimeout(() => { img.src = currentGallery[currentGalleryIndex]; img.classList.remove('scale-90'); img.classList.add('scale-100'); }, 120);
            }

            function prevLightbox() {
                if (!currentGallery || currentGallery.length === 0) return;
                currentGalleryIndex = (currentGalleryIndex - 1 + currentGallery.length) % currentGallery.length;
                const img = document.getElementById('lightbox-img');
                img.classList.add('scale-90');
                setTimeout(() => { img.src = currentGallery[currentGalleryIndex]; img.classList.remove('scale-90'); img.classList.add('scale-100'); }, 120);
            }

        function closeAllLightboxes() {
            const overlay = document.getElementById('lightbox-overlay');
            const img = document.getElementById('lightbox-img');
            // If we have a source card to animate back to, perform shared-element close
            try {
                if (lastOpenedCard && lastOpenedCard.getBoundingClientRect) {
                    animateCloseLightbox(lastOpenedCard);
                    return;
                }
            } catch (e) {}

            // fallback: immediate hide
            overlay.classList.add('opacity-0', 'pointer-events-none');
            img.classList.remove('scale-100');
            img.classList.add('scale-90');
            // Also hide the gallery selector if open
            try { closeGallerySelector(); } catch (e) {}
            // reset gallery state
            currentGallery = [];
            currentGalleryIndex = 0;
            // remove lightbox-open body class to restore UI
            document.body.classList.remove('lightbox-open');
        }

        function animateCloseLightbox(targetElem) {
            const overlay = document.getElementById('lightbox-overlay');
            const img = document.getElementById('lightbox-img');
            const src = img.src || '';
            if (!src) {
                // nothing to animate
                overlay.classList.add('opacity-0', 'pointer-events-none');
                document.body.classList.remove('lightbox-open');
                currentGallery = [];
                currentGalleryIndex = 0;
                return;
            }

            // compute start rect from visible lightbox image
            const startRect = img.getBoundingClientRect();

            // ensure target element is in DOM and visible; otherwise fallback
            let targetRect = null;
            try { targetRect = targetElem.getBoundingClientRect(); } catch (e) { targetRect = null; }

            // create clone at startRect
            const clone = document.createElement('img');
            clone.className = 'transition-clone';
            clone.src = src;
            clone.style.left = startRect.left + 'px';
            clone.style.top = startRect.top + 'px';
            clone.style.width = startRect.width + 'px';
            clone.style.height = startRect.height + 'px';
            document.body.appendChild(clone);

            // hide real lightbox image and overlay content
            img.style.visibility = 'hidden';

            // small delay to ensure clone added
            requestAnimationFrame(() => {
                if (!targetRect) {
                    // fade out and shrink to center
                    const centerW = 80, centerH = 60;
                    clone.style.left = (window.innerWidth/2 - centerW/2) + 'px';
                    clone.style.top = (window.innerHeight/2 - centerH/2) + 'px';
                    clone.style.width = centerW + 'px';
                    clone.style.height = centerH + 'px';
                    clone.style.opacity = '0';
                } else {
                    clone.style.left = targetRect.left + 'px';
                    clone.style.top = targetRect.top + 'px';
                    clone.style.width = targetRect.width + 'px';
                    clone.style.height = targetRect.height + 'px';
                    clone.style.borderRadius = window.getComputedStyle(targetElem).borderRadius || '8px';
                }

                const cleanup = () => {
                    clone.removeEventListener('transitionend', cleanup);
                    try { document.body.removeChild(clone); } catch (e) {}
                    // finally hide overlay
                    overlay.classList.add('opacity-0', 'pointer-events-none');
                    document.body.classList.remove('lightbox-open');
                    // Also hide the gallery selector if open
                    try { closeGallerySelector(); } catch (e) {}
                    // reset gallery state
                    currentGallery = [];
                    currentGalleryIndex = 0;
                    lastOpenedCard = null;
                };

                clone.addEventListener('transitionend', cleanup);
            });
        }

        // Close on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeAllLightboxes();
        });

        // Lightbox & Selector keyboard navigation
        document.addEventListener('keydown', (e) => {
            const overlay = document.getElementById('lightbox-overlay');
            const selector = document.getElementById('gallery-selector');
            const overlayVisible = overlay && !overlay.classList.contains('opacity-0');
            const selectorVisible = selector && selector.classList.contains('visible');

            if (overlayVisible) {
                if (e.key === 'ArrowRight') nextLightbox();
                if (e.key === 'ArrowLeft') prevLightbox();
            } else if (selectorVisible) {
                if (e.key === 'ArrowRight') setSelectorActive(currentGalleryIndex + 1);
                if (e.key === 'ArrowLeft') setSelectorActive(currentGalleryIndex - 1);
                if (e.key === 'Enter' || e.key === ' ') openLightboxFromGallery(currentGalleryIndex);
            }
        });

        // ====== DRAGGABLE GALLERY STACKS (POINTER + LONG PRESS) ======
        let draggedElement = null;
        let pointerId = null;
        let offsetX = 0;
        let offsetY = 0;
        let galleryPositions = {}; // Store positions per slide
        let longPressTimer = null;
        let isLongPressActive = false;
        let startX = 0;
        let startY = 0;
        let hasMoved = false;

    // When true, clicking a card will be suppressed (set during long-press)
    let suppressCardClick = false;
    // Reparenting helpers to keep active stack above overlays during drag
    let reparentedStack = false;
    let originalParent = null;
    let originalNextSibling = null;
    // Track the card that started a pointerdown so taps open that card reliably
    let pressedCard = null;

        // Load saved positions from sessionStorage (keeps positions while the tab is open)
        function loadGalleryPositions() {
            const saved = sessionStorage.getItem('galleryPositions');
            if (saved) {
                try {
                    galleryPositions = JSON.parse(saved);
                } catch (e) {
                    galleryPositions = {};
                }
            }
        }

        // Save positions to sessionStorage so they persist only for this tab session
        function saveGalleryPositions() {
            sessionStorage.setItem('galleryPositions', JSON.stringify(galleryPositions));
        }

        // Reset gallery to default position (remove saved position)
        function resetGalleryPosition(stack) {
            const slideIndex = currentSlide;
            const isFamily = stack.classList.contains('gallery-stack-family');
            const key = `slide${slideIndex}-${isFamily ? 'family' : 'landscape'}`;

            // Clear saved position
            delete galleryPositions[key];
            saveGalleryPositions();

            // Reset inline styles to use CSS defaults
            stack.style.left = '';
            stack.style.top = '';
            stack.style.right = '';
            stack.style.bottom = '';
            stack.style.transform = '';
        }

        // Restore gallery position for specific stack
        function restoreGalleryPosition(stack) {
            // Try to find the slide index the stack belongs to; fall back to currentSlide
            const slideElem = stack.closest('.slide');
            const slideIndex = slideElem && slideElem.dataset && typeof slideElem.dataset.index !== 'undefined' ? Number(slideElem.dataset.index) : currentSlide;
            const isFamily = stack.classList.contains('gallery-stack-family');
            const key = `slide${slideIndex}-${isFamily ? 'family' : 'landscape'}`;

            if (galleryPositions[key]) {
                const pos = galleryPositions[key];
                stack.style.left = pos.left;
                stack.style.top = pos.top;
                stack.style.right = pos.right || 'auto';
                stack.style.bottom = pos.bottom || 'auto';
                stack.style.transform = 'none';
            } else {
                // Use CSS default
                resetGalleryPosition(stack);
            }
        }

        // Pointer-based long-press and drag implementation
        function onPointerDown(e) {
            // Only left mouse button or touch/pen
            if (e.pointerType === 'mouse' && e.button !== 0) return;

            // Track which card (if any) the pointer started on so we can open it on tap
            pressedCard = e.target.closest ? e.target.closest('.gallery-card') : null;
            // Start regardless of whether the pointer started on an individual card
            // (we suppress the card click only if a long-press actually activates)
            const stack = e.currentTarget;
            stack.setPointerCapture(e.pointerId);
            pointerId = e.pointerId;
            startX = e.clientX;
            startY = e.clientY;
            hasMoved = false;

            // Clear any previous timers
            if (longPressTimer) { clearTimeout(longPressTimer); longPressTimer = null; }

            // Start long press timer (500ms)
            longPressTimer = setTimeout(() => {
                isLongPressActive = true;
                suppressCardClick = true; // prevent card click/lightbox while dragging
                draggedElement = stack;
                draggedElement.classList.add('long-press-active');
                // Improve rendering while moving and ensure deck remains sharp
                try { draggedElement.style.willChange = 'transform, left, top'; } catch (e) {}

                // Show overlay (blur/dim everything)
                const overlay = document.getElementById('drag-overlay');
                if (overlay) overlay.classList.add('active');

                // Reparent the active stack to document.body so it won't inherit any
                // ancestor filters and will always render above the overlay.
                if (draggedElement.parentNode !== document.body) {
                    originalParent = draggedElement.parentNode;
                    originalNextSibling = draggedElement.nextSibling;
                    document.body.appendChild(draggedElement);
                    reparentedStack = true;
                }
                // Ensure fixed positioning and high z-index while dragging
                try { draggedElement.style.position = 'fixed'; draggedElement.style.zIndex = '99999'; } catch (e) {}

                // Move the stack so it sits under the pointer immediately and
                // compute offsets so it follows the pointer (center under cursor).
                const width = draggedElement.offsetWidth || draggedElement.getBoundingClientRect().width;
                const height = draggedElement.offsetHeight || draggedElement.getBoundingClientRect().height;
                offsetX = Math.round(width / 2);
                offsetY = Math.round(height / 2);
                // Position immediately under the pointer so it doesn't stay at the
                // original location when dragging starts.
                try {
                    draggedElement.style.left = (e.clientX - offsetX) + 'px';
                    draggedElement.style.top = (e.clientY - offsetY) + 'px';
                    draggedElement.style.right = 'auto';
                    draggedElement.style.bottom = 'auto';
                } catch (err) {}

                // Provide haptic feedback
                if (navigator.vibrate) navigator.vibrate(20);
            }, 500);
        }

        function onPointerMove(e) {
            // If pointerId not set or different, ignore
            if (pointerId !== null && e.pointerId !== pointerId) return;

            // If long press hasn't activated yet, cancel if the user moved significantly
            if (!isLongPressActive) {
                const moveThreshold = 10;
                if (Math.abs(e.clientX - startX) > moveThreshold || Math.abs(e.clientY - startY) > moveThreshold) {
                    if (longPressTimer) { clearTimeout(longPressTimer); longPressTimer = null; }
                }
                return;
            }

            e.preventDefault();
            hasMoved = true;
            draggedElement.classList.add('dragging');

            // Follow mouse position directly
            let newX = e.clientX - offsetX;
            let newY = e.clientY - offsetY;

            // Constrain to viewport
            const maxX = window.innerWidth - draggedElement.offsetWidth;
            const maxY = window.innerHeight - draggedElement.offsetHeight;
            newX = Math.max(0, Math.min(newX, maxX));
            newY = Math.max(0, Math.min(newY, maxY));

            draggedElement.style.left = newX + 'px';
            draggedElement.style.top = newY + 'px';
            draggedElement.style.right = 'auto';
            draggedElement.style.bottom = 'auto';
            draggedElement.style.transform = 'scale(0.95)';
        }

        function onPointerUp(e) {
            // If pointerId not set or different, ignore
            if (pointerId !== null && e.pointerId !== pointerId) return;

            if (longPressTimer) { clearTimeout(longPressTimer); longPressTimer = null; }

            if (isLongPressActive && draggedElement) {
                draggedElement.classList.remove('dragging', 'long-press-active');
                draggedElement.style.transform = '';
                
                // Hide overlay
                const overlay = document.getElementById('drag-overlay');
                if (overlay) overlay.classList.remove('active');

                if (hasMoved) {
                    const slideIndex = currentSlide;
                    const isFamily = draggedElement.classList.contains('gallery-stack-family');
                    const key = `slide${slideIndex}-${isFamily ? 'family' : 'landscape'}`;

                    galleryPositions[key] = {
                        left: draggedElement.style.left,
                        top: draggedElement.style.top,
                        right: draggedElement.style.right,
                        bottom: draggedElement.style.bottom
                    };
                    saveGalleryPositions();
                }
            }

            // Release pointer capture
            try { if (e.currentTarget && e.currentTarget.hasPointerCapture(e.pointerId)) e.currentTarget.releasePointerCapture(e.pointerId); } catch (err) {}

            // If we reparented the stack, restore it to its original place in the DOM
            try {
                if (reparentedStack && draggedElement) {
                    if (originalParent) {
                        originalParent.insertBefore(draggedElement, originalNextSibling);
                    }
                }
            } catch (err) { console.warn('Failed to restore gallery stack parent', err); }

            // Reset inline styles applied during drag so the stack resumes normal CSS behavior
            try {
                if (draggedElement) {
                    draggedElement.style.position = '';
                    draggedElement.style.zIndex = '';
                    draggedElement.style.willChange = '';
                }
            } catch (e) {}

            // Clear reparent flags
            reparentedStack = false;
            originalParent = null;
            originalNextSibling = null;

            // Reset state
            draggedElement = null;
            pointerId = null;
            isLongPressActive = false;
            hasMoved = false;
            // After releasing, briefly suppress card clicks so the subsequent click event
            // (which may occur on touch devices) doesn't immediately open the image.
            setTimeout(() => { suppressCardClick = false; }, 300);
            // Remove blur class from body
            document.body.classList.remove('dragging-overlay');
            // Clear will-change
            try { if (e.target && e.target.nodeType === 1) e.target.style.willChange = ''; } catch (e) {}
            
        }

        // Detect quick taps (pointerup before long-press) and open lightbox reliably
        function handleTapOnPointerUp(e) {
            // If a long-press timer exists, long-press hasn't activated yet.
            if (longPressTimer) {
                // Clear pending long-press so it doesn't activate after the tap
                clearTimeout(longPressTimer);
                longPressTimer = null;

                // Only treat as a tap if we didn't move significantly
                if (!hasMoved) {
                    // Prefer the card recorded on pointerdown because event targets can change
                    const card = pressedCard || (e.target && e.target.closest ? e.target.closest('.gallery-card') : null);
                    if (card && !suppressCardClick && !isLongPressActive) {
                        try { toggleExpand(card); } catch (err) { console.warn('toggleExpand failed', err); }
                        // prevent inline onclick from firing after our programmatic open
                        ignoreNextInlineClick = true;
                        // ensure the flag doesn't stick around if the inline handler
                        // doesn't execute (some browsers or reparenting can prevent it)
                        setTimeout(() => { try { ignoreNextInlineClick = false; } catch (e) {} }, 400);
                    }
                }

                // Clear pressedCard after handling
                pressedCard = null;
            }
        }

        function initDraggableGalleries() {
            const stacks = document.querySelectorAll('.gallery-stack, .gallery-stack-family');

            stacks.forEach(stack => {
                // Use pointer events for unified mouse/touch
                stack.addEventListener('pointerdown', onPointerDown);
                stack.addEventListener('pointermove', onPointerMove);
                stack.addEventListener('pointerup', onPointerUp);
                stack.addEventListener('pointercancel', onPointerUp);
            });

            // Also listen at document level to handle moves/releases outside stack
            document.addEventListener('pointermove', onPointerMove);
            document.addEventListener('pointerup', onPointerUp);

            // We'll detect quick taps on pointerup (before long-press fires) and open
            // the lightbox from there. This is more reliable than relying on click
            // events which can be blocked by pointer capture/reparenting.
            document.addEventListener('pointerup', handleTapOnPointerUp, true);
        }

        // Initialize on load
        loadGalleryPositions();
        initDraggableGalleries();
    // Restore saved positions for all stacks immediately so positions persist across reloads
    document.querySelectorAll('.gallery-stack, .gallery-stack-family').forEach(stack => restoreGalleryPosition(stack));

        // Ensure positions are saved when the tab/window is closed or reloaded
        window.addEventListener('beforeunload', () => {
            try { saveGalleryPositions(); } catch (e) {}
        });

        // ====== DISCOVER MODAL SYSTEM ======
        const discoverData = {
            thailand: {
                title: 'Thailand',
                subtitle: 'Bangkok & Phuket',
                hero: 'images/Thailand/main/20250212_091343.jpg',
                stats: [
                    { label: 'Duration', value: '11 Days', icon: '🕰️' },
                    { label: 'Travel Dates', value: 'Feb 5-15', icon: '📅' },
                    { label: 'Golden Temples', value: '6+', icon: '⛩️' },
                    { label: 'Islands Explored', value: '3', icon: '🏝️' },
                    { label: 'Pad Thai Consumed', value: '∞', icon: '🍜' },
                    { label: 'Smiles Given', value: '1000+', icon: '😊' }
                ],
                mapPins: [
                    { lat: 13.7563, lng: 100.5018, name: 'Bangkok' },
                    { lat: 7.8804, lng: 98.3923, name: 'Phuket' }
                ],
                places: [
                    'Bangkok',
                    'Grand Palace',
                    'Wat Phra Kaew',
                    'Wat Pho',
                    'Wat Arun',
                    'Lumpini Park',
                    'Floating Market',
                    'Ayutthaya',
                    'Phuket',
                    'Phi Phi Islands',
                    'James Bond Island'
                ],
                food: {
                    title: 'Thai Culinary Adventure',
                    mostEaten: 'Pad Thai',
                    photos: [
                        'images/Thailand/food/20250207_135920.jpg',
                        'images/Thailand/food/20250208_142443.jpg',
                        'images/Thailand/food/20250209_142736.jpg',
                        'images/Thailand/food/20250211_124959.jpg',
                        'images/Thailand/food/20250213_151803.jpg'
                    ]
                },
                photos: [
                    'images/Thailand/landscape/20250206_184205.jpg',
                    'images/Thailand/landscape/20250207_094342.jpg',
                    'images/Thailand/landscape/20250207_094818.jpg',
                    'images/Thailand/landscape/20250207_100425.jpg',
                    'images/Thailand/landscape/20250207_101906.jpg',
                    'images/Thailand/landscape/20250207_105733.jpg',
                    'images/Thailand/landscape/20250207_121750.jpg',
                    'images/Thailand/landscape/20250207_152529(0).jpg',
                    'images/Thailand/landscape/20250208_104229.jpg',
                    'images/Thailand/landscape/20250208_153309.jpg',
                    'images/Thailand/landscape/20250209_102715.jpg',
                    'images/Thailand/landscape/20250209_144445.jpg',
                    'images/Thailand/landscape/20250209_150041.jpg',
                    'images/Thailand/landscape/20250210_111012.jpg',
                    'images/Thailand/landscape/20250210_184240.jpg',
                    'images/Thailand/landscape/20250211_185320(0).jpg',
                    'images/Thailand/landscape/20250212_091343.jpg',
                    'images/Thailand/landscape/20250212_092852.jpg',
                    'images/Thailand/landscape/20250212_142256.jpg',
                    'images/Thailand/landscape/20250213_103300.jpg',
                    'images/Thailand/family/20250207_160623.jpg',
                    'images/Thailand/family/20250207_194259.jpg',
                    'images/Thailand/family/20250208_112510.jpg',
                    'images/Thailand/family/20250209_104409.jpg',
                    'images/Thailand/family/20250209_160456.jpg',
                    'images/Thailand/family/20250212_150301.jpg',
                    'images/Thailand/family/20250212_151656.jpg',
                    'images/Thailand/family/20250213_141029.jpg',
                    'images/Thailand/family/20250213_142655.jpg',
                    'images/Thailand/family/IMG-9dff6a022c1d224d9c1bd639b5aa917e-V.jpg',
                    'images/Thailand/family/received_2034287637039199.jpeg'
                ]
            },
            tenerife: {
                title: 'Tenerife',
                subtitle: '',
                hero: 'images/Tenerife/main/20250419_202034.jpg',
                description: 'Where the volcano meets the ocean—a land of contrasts featuring black sand beaches, winding mountain roads, and the eternal spring sun.',
                stats: [
                    { label: 'Duration', value: '9 Days', icon: '🕰️' },
                    { label: 'Travel Dates', value: 'Apr 18-26', icon: '📅' },
                    { label: 'Peak Elevation', value: '3,718m', icon: '🏔️' },
                    { label: 'Temperature', value: '22°C', icon: '🌡️' },
                    { label: 'Dolphins Spotted', value: '50+', icon: '🐬' },
                    { label: 'Volcanic Views', value: 'Epic', icon: '🌋' }
                ],
                highlights: [
                    { title: 'Mount Teide', description: 'Spain\'s highest peak at 3,718m. Cable car to the summit reveals breathtaking views above the clouds—a lunar landscape frozen in time.' },
                    { title: 'Los Gigantes & Beaches', description: 'Towering 600m cliffs, black sand beaches at Los Cristianos, dramatic coastlines, and the crystal-clear Atlantic waters.' },
                    { title: 'Cueva del Viento & Pyramids', description: 'Explored one of the world\'s largest lava tubes, wandered the mysterious Pyramids of Güímar, and learned about the island\'s volcanic history.' },
                    { title: 'Loro Parque & Dolphins', description: 'World-class wildlife park, dolphin watching boat tours, and a day trip to La Gomera Island—unforgettable experiences with nature.' }
                ],
                timeline: [
                    { location: 'Los Cristianos' },
                    { location: 'Mount Teide' },
                    { location: 'Cueva del Viento' },
                    { location: 'Pyramids of Guimar' },
                    { location: 'Loro Parque' },
                    { location: 'La Gomera Island' },
                    { location: 'Los Gigantes' },
                    { location: 'Santa Cruz' }
                ],
                photos: [
                    'images/Tenerife/landscape/1000091123.jpg',
                    'images/Tenerife/landscape/1000091445.jpg',
                    'images/Tenerife/landscape/20250419_202034.jpg',
                    'images/Tenerife/landscape/20250420_145047.jpg',
                    'images/Tenerife/landscape/20250420_150357.jpg',
                    'images/Tenerife/landscape/20250420_151541.jpg',
                    'images/Tenerife/landscape/20250420_172253.jpg',
                    'images/Tenerife/landscape/20250420_185551.jpg',
                    'images/Tenerife/landscape/20250420_193320.jpg',
                    'images/Tenerife/landscape/20250421_133945.jpg',
                    'images/Tenerife/landscape/20250421_180539.jpg',
                    'images/Tenerife/landscape/20250421_202727.jpg',
                    'images/Tenerife/landscape/20250422_114214.jpg',
                    'images/Tenerife/landscape/20250422_131126.jpg',
                    'images/Tenerife/landscape/20250422_153410.jpg',
                    'images/Tenerife/landscape/20250422_180848.jpg',
                    'images/Tenerife/landscape/20250422_204427.jpg',
                    'images/Tenerife/landscape/20250423_120749.jpg',
                    'images/Tenerife/landscape/20250423_170711.jpg',
                    'images/Tenerife/landscape/20250423_172757.jpg',
                    'images/Tenerife/landscape/20250423_201745.jpg',
                    'images/Tenerife/landscape/20250423_203300.jpg',
                    'images/Tenerife/landscape/20250424_111822.jpg',
                    'images/Tenerife/landscape/20250424_131637.jpg',
                    'images/Tenerife/landscape/20250424_184036.jpg',
                    'images/Tenerife/landscape/20250424_194531.jpg',
                    'images/Tenerife/landscape/20250424_202936.jpg',
                    'images/Tenerife/landscape/20250424_203713.jpg',
                    'images/Tenerife/landscape/20250425_103033.jpg',
                    'images/Tenerife/landscape/20250425_113319.jpg',
                    'images/Tenerife/landscape/20250425_135245.jpg',
                    'images/Tenerife/landscape/20250425_144340.jpg',
                    'images/Tenerife/family/20250419_202310.jpg',
                    'images/Tenerife/family/20250420_105237.jpg',
                    'images/Tenerife/family/20250420_132901.jpg',
                    'images/Tenerife/family/20250420_145422.jpg',
                    'images/Tenerife/family/20250420_185822.jpg',
                    'images/Tenerife/family/20250421_171735.jpg',
                    'images/Tenerife/family/20250421_174345.jpg',
                    'images/Tenerife/family/20250421_181430.jpg',
                    'images/Tenerife/family/20250421_201811.jpg',
                    'images/Tenerife/family/20250422_135515.jpg',
                    'images/Tenerife/family/20250422_165423.jpg',
                    'images/Tenerife/family/20250425_203249.jpg'
                ]
            },
            switzerland: {
                title: 'Switzerland',
                subtitle: '',
                hero: 'images/Switzerland/main/20250824_093817.jpg',
                description: 'Epic mountain passes, pristine alpine lakes, and the Top of Europe. A road trip through Switzerland is a journey into pure natural beauty.',
                stats: [
                    { label: 'Duration', value: '8 Days', icon: '🕰️' },
                    { label: 'Travel Dates', value: 'Aug 22-29', icon: '📅' },
                    { label: 'Highest Point', value: '3,454m', icon: '🏔️' },
                    { label: 'Endless Chocolate', value: '∞', icon: '🍫' },
                    { label: 'Mountain Views', value: 'Epic', icon: '🏔️' }
                ],
                highlights: [
                    { title: 'Jungfraujoch - Top of Europe', description: 'The legendary Top of Europe at 3,454m. Glacier views, ice palace, and the Sphinx Observatory—standing on top of the world with 360° Alpine panoramas.' },
                    { title: 'Luzern & Lake Views', description: 'Explored the Chapel Bridge, wandered the old town, and took in the stunning lake and mountain views in this postcard-perfect Swiss city.' },
                    { title: 'Aare Gorge & Reichenbachfall', description: 'Walked through the dramatic limestone Aare Gorge and hiked to Reichenbachfall (Reichenbach Falls)—where Sherlock Holmes "died" in Conan Doyle\'s story.' },
                    { title: 'Lindt Home of Chocolate', description: 'Visited the world\'s largest chocolate fountain at Lindt\'s immersive museum in Zürich—a sweet finale to our Swiss adventure!' }
                ],
                timeline: [
                    { location: 'Luzern' },
                    { location: 'Aare Gorge' },
                    { location: 'Reichenbachfall' },
                    { location: 'Interlaken' },
                    { location: 'Jungfraujoch' },
                    { location: 'Zurich' },
                    { location: 'ETH Zurich' },
                    { location: 'Stoos' },
                    { location: 'Bern' },
                    { location: 'Lindt Home of Chocolate' }
                ],
                photos: [
                    'images/Switzerland/landscape/1000103053.jpg',
                    'images/Switzerland/landscape/20250822_184427.jpg',
                    'images/Switzerland/landscape/20250822_185907.jpg',
                    'images/Switzerland/landscape/20250822_185921.jpg',
                    'images/Switzerland/landscape/20250822_190425.jpg',
                    'images/Switzerland/landscape/20250822_190531.jpg',
                    'images/Switzerland/landscape/20250823_110251.jpg',
                    'images/Switzerland/landscape/20250823_110902.jpg',
                    'images/Switzerland/landscape/20250823_111829.jpg',
                    'images/Switzerland/landscape/20250823_112445.jpg',
                    'images/Switzerland/landscape/20250823_124725.jpg',
                    'images/Switzerland/landscape/20250823_173022.jpg',
                    'images/Switzerland/landscape/20250823_173230.jpg',
                    'images/Switzerland/landscape/20250824_065515.jpg',
                    'images/Switzerland/landscape/20250824_093817.jpg',
                    'images/Switzerland/landscape/20250824_094116.jpg',
                    'images/Switzerland/landscape/20250824_105117.jpg',
                    'images/Switzerland/landscape/20250824_110147.jpg',
                    'images/Switzerland/landscape/20250824_144457.jpg',
                    'images/Switzerland/landscape/20250824_204546.jpg',
                    'images/Switzerland/landscape/20250824_205310.jpg',
                    'images/Switzerland/landscape/20250825_094057.jpg',
                    'images/Switzerland/landscape/20250825_100803.jpg',
                    'images/Switzerland/landscape/20250825_111557.jpg',
                    'images/Switzerland/landscape/20250825_134241.jpg',
                    'images/Switzerland/landscape/20250825_160919.jpg',
                    'images/Switzerland/landscape/20250825_202705.jpg',
                    'images/Switzerland/landscape/20250826_104750.jpg',
                    'images/Switzerland/landscape/20250826_110023.jpg',
                    'images/Switzerland/landscape/20250826_125257.jpg',
                    'images/Switzerland/landscape/20250826_133037.jpg',
                    'images/Switzerland/landscape/20250827_123218.jpg',
                    'images/Switzerland/landscape/20250828_185709.jpg',
                    'images/Switzerland/landscape/20250828_190426.jpg',
                    'images/Switzerland/family/20250822_183720.jpg',
                    'images/Switzerland/family/20250822_191056.jpg',
                    'images/Switzerland/family/20250822_201443.jpg',
                    'images/Switzerland/family/20250824_094319.jpg',
                    'images/Switzerland/family/20250824_104213.jpg',
                    'images/Switzerland/family/20250824_104256.jpg',
                    'images/Switzerland/family/20250824_105544.jpg',
                    'images/Switzerland/family/20250825_191416.jpg'
                ]
            },
            germany: {
                title: 'Germany & Switzerland',
                subtitle: '',
                hero: 'images/SwitzerlandGermany/main/20251026_131424.jpg',
                description: 'Crossing borders through golden forests, historic cities, and misty valleys. An autumn adventure blending culture, nature, and adventure.',
                stats: [
                    { label: 'Duration', value: '8 Days', icon: '🕰️' },
                    { label: 'Travel Dates', value: 'Oct 23-30', icon: '📅' },
                    { label: 'Countries', value: '2', icon: '🇩🇪🇨🇭' },
                    { label: 'Major Cities', value: '4', icon: '🏙️' },
                    { label: 'Castles Visited', value: '1', icon: '🏰' },
                    { label: 'Adventure', value: '100%', icon: '🎒' }
                ],
                highlights: [
                    { title: 'Munich', description: 'Bavarian capital full of history, beer gardens, and architectural marvels. Explored BMW Museum, Olympiapark, Deutsches Museum, and enjoyed authentic German cuisine at Hofbräuhaus.' },
                    { title: 'Neuschwanstein Castle', description: 'The fairy tale castle that inspired Disney. Perched on a hilltop with mountain views that look like pure fantasy—a day trip from Munich.' },
                    { title: 'Salzburg, Austria', description: 'Mozart\'s birthplace with baroque architecture, the Hohensalzburg Fortress, and the Sound of Music filming locations. A cultural treasure nestled in the Alps.' },
                    { title: 'House of Läderach & Swiss Chocolate', description: 'Visited Läderach chocolate factory in Zürich—tasted fresh Swiss chocolate and explored the art of Swiss confectionery at its finest.' }
                ],
                timeline: [
                    { location: 'Salzburg' },
                    { location: 'Hohensalzburg Fortress' },
                    { location: 'Zurich' },
                    { location: 'Rufi' },
                    { location: 'Laderach Chocolate Factory' },
                    { location: 'Neuschwanstein Castle' },
                    { location: 'Munich' },
                    { location: 'BMW Museum' },
                    { location: 'Olympiapark' },
                    { location: 'Deutsches Museum' },
                    { location: 'Hofbrauhaus' }
                ],
                photos: [
                    'images/SwitzerlandGermany/landscape/1000105950.jpg',
                    'images/SwitzerlandGermany/landscape/20251023_155831.jpg',
                    'images/SwitzerlandGermany/landscape/20251025_110422.jpg',
                    'images/SwitzerlandGermany/landscape/20251025_123654.jpg',
                    'images/SwitzerlandGermany/landscape/20251026_083616.jpg',
                    'images/SwitzerlandGermany/landscape/20251026_102509(0).jpg',
                    'images/SwitzerlandGermany/landscape/20251026_112607.jpg',
                    'images/SwitzerlandGermany/landscape/20251026_120533.jpg',
                    'images/SwitzerlandGermany/landscape/20251026_125601.jpg',
                    'images/SwitzerlandGermany/landscape/20251026_131424.jpg',
                    'images/SwitzerlandGermany/landscape/20251027_151204.jpg',
                    'images/SwitzerlandGermany/landscape/20251028_101819.jpg',
                    'images/SwitzerlandGermany/landscape/20251028_104027.jpg',
                    'images/SwitzerlandGermany/landscape/20251028_110157.jpg',
                    'images/SwitzerlandGermany/landscape/20251028_164700.jpg',
                    'images/SwitzerlandGermany/landscape/20251028_164752.jpg',
                    'images/SwitzerlandGermany/landscape/20251028_171421.jpg',
                    'images/SwitzerlandGermany/family/20251023_153725.jpg',
                    'images/SwitzerlandGermany/family/20251023_170424.jpg',
                    'images/SwitzerlandGermany/family/20251027_153950.jpg',
                    'images/SwitzerlandGermany/family/20251028_101902.jpg',
                    'images/SwitzerlandGermany/family/20251028_110147.jpg',
                    'images/SwitzerlandGermany/family/IMG-c7852f75d4501f0d8fdee50872632451-V.jpg',
                    'images/SwitzerlandGermany/family/IMG-d5bfe8be6fee530bbaa98807b9598c6b-V.jpg',
                    'images/SwitzerlandGermany/family/received_1824136905159328.jpeg',
                    'images/SwitzerlandGermany/family/received_838421232171888.jpeg'
                ]
            }
        };

        function openDiscoverModal(destination) {
            const modal = document.getElementById('discover-modal');
            const content = document.getElementById('discover-modal-content');
            const data = discoverData[destination];

            if (!data || !modal || !content) return;

            // Subtle haptic feedback
            if (navigator.vibrate) navigator.vibrate(10);

            // Build the modal content
            const html = `
                <!-- Cinematic Hero Section -->
                <div class="discover-hero animate-slide-in">
                    <img src="${data.hero}" alt="${data.title}">
                    <div class="discover-hero-content">
                        <span class="discover-subtitle">${data.subtitle}</span>
                        <h1 class="discover-title text-depth">${data.title}</h1>
                    </div>
                </div>

                <!-- Section Divider -->
                <div class="section-divider"></div>

                <!-- Map Section -->
                <h2 class="section-header animate-slide-in">Where We Went</h2>
                <div class="mb-24" style="max-width: 900px; margin-left: auto; margin-right: auto;">
                    <div style="width: 100%; height: 500px; background: #1a1a1a; border-radius: 16px; overflow: hidden; position: relative; border: 1px solid rgba(255,255,255,0.1);">
                        <div id="discover-map-${destination}" style="width: 100%; height: 100%;"></div>
                    </div>
                </div>

                <!-- Section Divider -->
                <div class="section-divider"></div>

                <!-- Places List -->
                ${data.places ? `
                    <h2 class="section-header animate-slide-in">Places Visited</h2>
                    <div class="mb-24" style="max-width: 900px;">
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-6">
                            ${data.places.map((place, i) => `
                                <div class="stagger-item" style="animation-delay: ${0.05 * i}s">
                                    <div class="text-white text-xl font-bold mb-1" style="text-shadow: 0 2px 10px rgba(0,0,0,0.5);">📍 ${place}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}

                <!-- Section Divider -->
                <div class="section-divider"></div>

                <!-- Timeline Section -->
                ${data.timeline ? `
                    <h2 class="section-header animate-slide-in">Journey Highlights</h2>
                    <div class="mb-24" style="max-width: 900px;">
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-6">
                            ${data.timeline.map((t, i) => `
                                <div class="stagger-item" style="animation-delay: ${0.05 * i}s">
                                    <div class="text-white text-xl font-bold mb-1" style="text-shadow: 0 2px 10px rgba(0,0,0,0.5);">• ${t.location}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}

                ${data.food ? `
                    <!-- Section Divider -->
                    <div class="section-divider"></div>

                    <!-- Food Section -->
                    <h2 class="section-header animate-slide-in">${data.food.title}</h2>
                    <div class="mb-12" style="max-width: 900px;">
                        ${data.food.description ? `<p class="text-lg text-gray-300 leading-relaxed font-light mb-8">${data.food.description}</p>` : ''}
                        <div class="highlight-card mb-12">
                            <h3 class="text-3xl font-black text-white mb-4 relative z-10">Most Eaten: ${data.food.mostEaten}</h3>
                            ${data.food.mostEatenDescription ? `<p class="text-lg text-gray-300 leading-relaxed font-light relative z-10">${data.food.mostEatenDescription}</p>` : ''}
                        </div>
                    </div>
                    
                    <!-- Food Gallery -->
                    <div class="photo-grid mb-24">
                        ${data.food.photos.map((photo, i) => `
                            <div class="photo-grid-item zoom-on-hover stagger-item" onclick="openPhotoLightbox('${photo}')" style="animation-delay: ${0.06 * i}s">
                                <img src="${photo}" alt="Thai Food" loading="lazy">
                                <div style="position: absolute; bottom: 0; left: 0; right: 0; padding: 20px; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); opacity: 0; transition: opacity 400ms; z-index: 3;" onmouseenter="this.style.opacity='1'" onmouseleave="this.style.opacity='0'">
                                    <p class="text-white text-sm font-semibold">View Full Size</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}

                <!-- Section Divider -->
                <div class="section-divider"></div>

                <!-- Photo Gallery -->
                <h2 class="section-header animate-slide-in">Visual Memories</h2>
                <div class="photo-grid mb-20">
                    ${data.photos.map((photo, i) => `
                        <div class="photo-grid-item zoom-on-hover stagger-item" onclick="openPhotoLightbox('${photo}')" style="animation-delay: ${0.06 * i}s">
                            <img src="${photo}" alt="${data.title}" loading="lazy">
                            <div style="position: absolute; bottom: 0; left: 0; right: 0; padding: 20px; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); opacity: 0; transition: opacity 400ms; z-index: 3;" onmouseenter="this.style.opacity='1'" onmouseleave="this.style.opacity='0'">
                                <p class="text-white text-sm font-semibold">View Full Size</p>
                            </div>
                        </div>
                    `).join('')}
                </div>

                <!-- Close Button -->
                <div class="text-center py-16">
                    <button onclick="closeDiscoverModal()" class="discover-btn">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        <span>Return to Journey</span>
                    </button>
                </div>
            `;

            content.innerHTML = html;
            
            // Initialize map for this destination - wait for Google Maps to be ready
            const initMap = () => {
                if (data.mapPins && data.mapPins.length > 0) {
                    if (window.google && window.google.maps) {
                        initializeDiscoverMap(destination, data.mapPins);
                    } else {
                        // If Google Maps not ready yet, wait and try again
                        setTimeout(initMap, 200);
                    }
                }
            };
            setTimeout(initMap, 100);
            
            // Force scroll to top
            content.scrollTop = 0;
            modal.scrollTop = 0;
            
            // Open modal with cinematic fade
            requestAnimationFrame(() => {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            });
        }

        function initializeDiscoverMap(destination, pins) {
            const mapDiv = document.getElementById(`discover-map-${destination}`);
            if (!mapDiv) {
                console.error('Map div not found for:', destination);
                return;
            }
            if (!window.google || !window.google.maps) {
                console.error('Google Maps API not loaded');
                return;
            }

            console.log('Initializing map for', destination, 'with', pins.length, 'pins');

            // Calculate center based on pins
            const centerLat = pins.reduce((sum, pin) => sum + pin.lat, 0) / pins.length;
            const centerLng = pins.reduce((sum, pin) => sum + pin.lng, 0) / pins.length;
            
            // Calculate zoom based on pin spread
            let zoom = 8;
            if (pins.length > 1) {
                const lats = pins.map(p => p.lat);
                const lngs = pins.map(p => p.lng);
                const latDiff = Math.max(...lats) - Math.min(...lats);
                const lngDiff = Math.max(...lngs) - Math.min(...lngs);
                const maxDiff = Math.max(latDiff, lngDiff);
                
                if (maxDiff > 10) zoom = 5;
                else if (maxDiff > 5) zoom = 6;
                else if (maxDiff > 2) zoom = 7;
            }

            // Create Google Map with dark theme
            const map = new google.maps.Map(mapDiv, {
                center: { lat: centerLat, lng: centerLng },
                zoom: zoom,
                styles: [
                    { elementType: "geometry", stylers: [{ color: "#1a1a1a" }] },
                    { elementType: "labels.text.stroke", stylers: [{ color: "#1a1a1a" }] },
                    { elementType: "labels.text.fill", stylers: [{ color: "#999999" }] },
                    {
                        featureType: "administrative.locality",
                        elementType: "labels.text.fill",
                        stylers: [{ color: "#d59563" }],
                    },
                    {
                        featureType: "poi",
                        elementType: "labels.text.fill",
                        stylers: [{ color: "#666666" }],
                    },
                    {
                        featureType: "poi.park",
                        elementType: "geometry",
                        stylers: [{ color: "#263c3f" }],
                    },
                    {
                        featureType: "poi.park",
                        elementType: "labels.text.fill",
                        stylers: [{ color: "#6b9a76" }],
                    },
                    {
                        featureType: "road",
                        elementType: "geometry",
                        stylers: [{ color: "#2c2c2c" }],
                    },
                    {
                        featureType: "road",
                        elementType: "geometry.stroke",
                        stylers: [{ color: "#1a1a1a" }],
                    },
                    {
                        featureType: "road",
                        elementType: "labels.text.fill",
                        stylers: [{ color: "#8a8a8a" }],
                    },
                    {
                        featureType: "road.highway",
                        elementType: "geometry",
                        stylers: [{ color: "#3c3c3c" }],
                    },
                    {
                        featureType: "road.highway",
                        elementType: "geometry.stroke",
                        stylers: [{ color: "#1f2833" }],
                    },
                    {
                        featureType: "road.highway",
                        elementType: "labels.text.fill",
                        stylers: [{ color: "#f3d19c" }],
                    },
                    {
                        featureType: "transit",
                        elementType: "geometry",
                        stylers: [{ color: "#2f3948" }],
                    },
                    {
                        featureType: "transit.station",
                        elementType: "labels.text.fill",
                        stylers: [{ color: "#d59563" }],
                    },
                    {
                        featureType: "water",
                        elementType: "geometry",
                        stylers: [{ color: "#17263c" }],
                    },
                    {
                        featureType: "water",
                        elementType: "labels.text.fill",
                        stylers: [{ color: "#515c6d" }],
                    },
                    {
                        featureType: "water",
                        elementType: "labels.text.stroke",
                        stylers: [{ color: "#17263c" }],
                    },
                ],
                disableDefaultUI: false,
                zoomControl: true,
                mapTypeControl: false,
                streetViewControl: false,
                fullscreenControl: true,
            });

            // Add markers for each pin
            pins.forEach((pin, i) => {
                const marker = new google.maps.Marker({
                    position: { lat: pin.lat, lng: pin.lng },
                    map: map,
                    title: pin.name,
                    animation: google.maps.Animation.DROP,
                    icon: {
                        path: google.maps.SymbolPath.CIRCLE,
                        scale: 10,
                        fillColor: "#ef4444",
                        fillOpacity: 1,
                        strokeColor: "#ffffff",
                        strokeWeight: 3,
                    }
                });

                // Add info window
                const infoWindow = new google.maps.InfoWindow({
                    content: `<div style="color: #000; font-weight: bold; padding: 8px;">${pin.name}</div>`
                });

                marker.addListener("click", () => {
                    infoWindow.open(map, marker);
                });

                // Auto-open first marker's info
                if (i === 0) {
                    setTimeout(() => infoWindow.open(map, marker), 500);
                }
            });
        }

        function closeDiscoverModal() {
            const modal = document.getElementById('discover-modal');
            const content = document.getElementById('discover-modal-content');
            
            if (modal) {
                // Fade out content first
                if (content) {
                    content.style.transform = 'translateY(50px)';
                    content.style.opacity = '0';
                }
                
                // Then close modal
                setTimeout(() => {
                    modal.classList.remove('active');
                    document.body.style.overflow = 'hidden'; // Keep hidden since main site is fullscreen
                    
                    // Reset content transform for next open
                    if (content) {
                        setTimeout(() => {
                            content.style.transform = '';
                            content.style.opacity = '';
                        }, 400);
                    }
                }, 300);
                
                // Subtle haptic feedback
                if (navigator.vibrate) navigator.vibrate(5);
            }
        }

        function showWorldMap() {
            const modal = document.getElementById('world-map-modal');
            const content = document.getElementById('world-map-content');
            
            if (!modal || !content) return;

            // Get all map pins from all destinations
            const allPins = [
                ...discoverData.thailand.mapPins.map(p => ({...p, destination: 'Thailand'})),
                ...discoverData.tenerife.mapPins.map(p => ({...p, destination: 'Tenerife'})),
                ...discoverData.switzerland.mapPins.map(p => ({...p, destination: 'Switzerland'})),
                ...discoverData.germany.mapPins.map(p => ({...p, destination: 'Germany & Switzerland'}))
            ];

            // Initialize the world map with Google Maps
            setTimeout(() => {
                const mapDiv = document.getElementById('world-map');
                if (!mapDiv || !window.google) return;

                // Create Google Map centered on Europe
                const map = new google.maps.Map(mapDiv, {
                    center: { lat: 45, lng: 15 },
                    zoom: 3,
                    styles: [
                        { elementType: "geometry", stylers: [{ color: "#1a1a1a" }] },
                        { elementType: "labels.text.stroke", stylers: [{ color: "#1a1a1a" }] },
                        { elementType: "labels.text.fill", stylers: [{ color: "#999999" }] },
                        {
                            featureType: "water",
                            elementType: "geometry",
                            stylers: [{ color: "#0d1117" }],
                        },
                    ],
                    disableDefaultUI: false,
                    zoomControl: true,
                    mapTypeControl: false,
                    streetViewControl: false,
                    fullscreenControl: true,
                });

                // Add markers for each pin
                const colors = ['#ef4444', '#3b82f6', '#10b981', '#f59e0b'];
                allPins.forEach((pin, i) => {
                    const marker = new google.maps.Marker({
                        position: { lat: pin.lat, lng: pin.lng },
                        map: map,
                        title: pin.name,
                        animation: google.maps.Animation.DROP,
                        icon: {
                            path: google.maps.SymbolPath.CIRCLE,
                            scale: 12,
                            fillColor: colors[i % colors.length],
                            fillOpacity: 1,
                            strokeColor: "#ffffff",
                            strokeWeight: 3,
                        }
                    });

                    // Add info window
                    const infoWindow = new google.maps.InfoWindow({
                        content: `<div style="color: #000; font-weight: bold; padding: 8px;">
                            ${pin.name}<br/>
                            <span style="font-size: 12px; color: #666;">${pin.destination}</span>
                        </div>`
                    });

                    marker.addListener("click", () => {
                        infoWindow.open(map, marker);
                    });
                });
            }, 100);

            // Open modal
            requestAnimationFrame(() => {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            });
        }

        function closeWorldMap() {
            const modal = document.getElementById('world-map-modal');
            const content = document.getElementById('world-map-content');
            
            if (modal) {
                if (content) {
                    content.style.transform = 'translateY(50px)';
                    content.style.opacity = '0';
                }
                
                setTimeout(() => {
                    modal.classList.remove('active');
                    document.body.style.overflow = 'hidden';
                    
                    if (content) {
                        setTimeout(() => {
                            content.style.transform = '';
                            content.style.opacity = '';
                        }, 400);
                    }
                }, 300);
            }
        }

        function restartJourney() {
            // Smoothly scroll to top
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
            
            // Wait for scroll, then reload to restart all animations
            setTimeout(() => {
                location.reload();
            }, 800);
        }

        function openPhotoLightbox(photoUrl) {
            // Reuse existing lightbox
            const overlay = document.getElementById('lightbox-overlay');
            const img = document.getElementById('lightbox-img');
            
            if (overlay && img) {
                img.src = photoUrl;
                overlay.classList.remove('opacity-0', 'pointer-events-none');
                document.body.classList.add('lightbox-open');
                setTimeout(() => {
                    img.classList.remove('scale-90');
                    img.classList.add('scale-100');
                }, 40);
            }
        }

        // Close discover modal on escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const modal = document.getElementById('discover-modal');
                if (modal && modal.classList.contains('active')) {
                    closeDiscoverModal();
                }
            }
        });
    </script>
</body>
</html>
